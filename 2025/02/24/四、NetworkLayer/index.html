<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="x5-fullscreen" content="true">
<meta name="full-screen" content="yes">
<meta name="theme-color" content="#317EFB" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=0" name="viewport">
<meta name="description" content="第三层：网络层 Overview of the Network Layer IP Addresses and Subnets Layer 3 Devices  ARP Protocol Network Layer Services Routed and Routing Protocols VLSM ICMP 为什么我们不用硬件地址进行通信? (设备数量问题)因为设备比较多，供应商也比较多 (规格问">
<meta property="og:type" content="article">
<meta property="og:title" content="四、OSI第三层：数据链路层">
<meta property="og:url" content="http://example.com/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/index.html">
<meta property="og:site_name" content="Universe Hamster">
<meta property="og:description" content="第三层：网络层 Overview of the Network Layer IP Addresses and Subnets Layer 3 Devices  ARP Protocol Network Layer Services Routed and Routing Protocols VLSM ICMP 为什么我们不用硬件地址进行通信? (设备数量问题)因为设备比较多，供应商也比较多 (规格问">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="og:image" content="http://example.com/img/404.jpg">
<meta property="article:published_time" content="2025-02-24T09:32:15.355Z">
<meta property="article:modified_time" content="2025-02-24T09:32:55.692Z">
<meta property="article:author" content="Zhang Keyaoo">
<meta property="article:tag" content="笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/404.jpg">


<title >四、OSI第三层：数据链路层</title>

<!-- Favicon -->

    <link href='/assets/favicon.png?v=2.2.4' rel='icon' type='image/png' sizes='16x16' ></link>


    <link href='/assets/favicon.png?v=2.2.4' rel='icon' type='image/png' sizes='32x32' ></link>




<!-- Plugin -->




    
<link rel="stylesheet" href="/css/plugins/bootstrap.row.css">

    
<link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.css">

    
    




<!-- Icon -->

    
<link rel="stylesheet" href="/css/plugins/font-awesome.min.css">




<!-- Variable -->
<script>window.ASYNC_CONFIG = {"hostname":"example.com","author":"Zhang Keyaoo","root":"/","typed_text":null,"theme_version":"2.2.4","theme":{"switch":true,"default":"style-light"},"favicon":{"logo":"/assets/favicon.svg","icon16":"/assets/favicon.png","icon32":"/assets/favicon.png","apple_touch_icon":null,"webmanifest":null,"visibilitychange":false,"hidden":"/failure.ico","show_text":"(/≧▽≦/)Hey! Good again!","hide_text":"(●—●)Oh, crash!"},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms","author":"Post author: ","copyright_link":"Post link: ","copyright_license_title":"Copyright Notice: ","copyright_license_content":"All articles in this blog are licensed under undefined unless otherwise stated.","copy_success":"Copied","copy_failure":"Copy failed","open_read_mode":"Enter reading mode","exit_read_mode":"Exit reading mode","notice_outdate_message":"It has been undefined days since the last update, the content of the article may be outdated.","sticky":"TOP","just":"Just","min":"minutes ago","hour":"hours ago","day":"days ago","month":"months ago"},"swup":false,"plugin":{"flickr_justified_gallery":"https://unpkg.com/flickr-justified-gallery@latest/dist/fjGallery.min.js"},"icons":{"sun":"far fa-sun","moon":"far fa-moon","play":"fas fa-play","email":"far fa-envelope","next":"fas fa-arrow-right","calendar":"far fa-calendar-alt","clock":"far fa-clock","user":"far fa-user","back_top":"fas fa-arrow-up","close":"fas fa-times","search":"fas fa-search","reward":"fas fa-hand-holding-usd","toc_tag":"fas fa-th-list","read":"fas fa-book-reader","arrows":"fas fa-arrows-alt-h","double_arrows":"fas fa-angle-double-down","copy":"fas fa-copy"},"icontype":"font","highlight":{"plugin":"highlighjs","theme":true,"copy":true,"lang":true,"title":"default","height_limit":false},"toc":{"post_title":false},"live_time":{"start_time":"02/20/2025 00:00:00","prefix":"The blog has been lovely to run undefined day"},"danmu":{"enable":false,"el":".trm-banner"},"search":{"enable":true,"type":"local","href":"https://www.google.com/search?q=site:","domain":null,"path":"search.xml"}};</script>
<script id="async-page-config">window.PAGE_CONFIG = {"isPost":true,"isHome":false,"postUpdate":"2025-02-24 17:32:55"};</script>

<!-- Theme mode css -->
<link data-swup-theme rel="stylesheet" href="/css/index.css?v=2.2.4" id="trm-switch-style">
<script>
    let defaultMode = ASYNC_CONFIG.theme.default !=='auto' ?  ASYNC_CONFIG.theme.default : (window.matchMedia("(prefers-color-scheme: light)").matches ? 'style-light' : 'style-dark')
    let catchMode = localStorage.getItem('theme-mode') || defaultMode;
    let type = catchMode === 'style-dark' ? 'add' : 'remove';
    document.documentElement.classList[type]('dark')
</script>

<!-- CDN -->


    
    



<!-- Site Analytics -->

 
<meta name="generator" content="Hexo 7.3.0"></head>

<body>

  <!-- app wrapper -->
  <div class="trm-app-frame">

    <!-- page preloader -->
    <div class="trm-preloader">
    <div class="trm-holder">
        <div class="preloader">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div>
    <!-- page preloader end -->

    <!-- change mode preloader -->
    <div class="trm-mode-swich-animation-frame">
    <div class="trm-mode-swich-animation">
        <i class="i-sun"><i class="iconfont far fa-sun"></i></i>
        <div class="trm-horizon"></div>
        <i class="i-moon"><i class="iconfont far fa-moon"></i></i>
    </div>
</div>
    <!-- change mode preloader end -->

      <!-- scroll container -->
      <div id="trm-dynamic-content" class="trm-swup-animation">
        <div id="trm-scroll-container" class="trm-scroll-container" style="opacity: 0">
            <!-- top bar -->
            <header class="trm-top-bar">
	<div class="container">
		<div class="trm-left-side">
			<!-- logo -->
<a href="/" class="trm-logo-frame trm-anima-link">
    
        <img alt="logo" src="/assets/favicon.svg">
    
    
        <div class="trm-logo-text">
            Zhang<span>Keyaoo</span>
        </div>
    
</a>
<!-- logo end -->
		</div>
		<div class="trm-right-side">
			<!-- menu -->
<div class="trm-menu">
    <nav>
        <ul>
            
            <li class="menu-item-has-children ">
                <a  href="/" target="">
                    主页
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/archives/" target="">
                    归档
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/categories/" target="">
                    分类
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/tags/" target="">
                    标签
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/links/" target="">
                    友链
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/about/" target="">
                    关于
                </a>
                
            </li>
            
        </ul>
    </nav>
</div>
<!-- menu end -->
			
    <!-- mode switcher place -->
    <div class="trm-mode-switcher-place">
        <div class="trm-mode-switcher">
            <i class="iconfont far fa-sun"></i>
            <input class="tgl tgl-light" id="trm-swich" type="checkbox">
            <label class="trm-swich" for="trm-swich"></label>
            <i class="iconfont far fa-moon"></i>
        </div>
    </div>
    <!-- mode switcher place end -->

			
    
    <div id="trm-search-btn" class="trm-search-btn">
        <i class="iconfont fas fa-search"></i>
    </div>
     

		</div>
		<div class="trm-menu-btn">
			<span></span>
		</div>
	</div>
</header>
            <!-- top bar end -->

            <!-- body -->
            
<div class="trm-content-start">
    <!-- banner -->
    <div class="trm-banner">
    
    <!-- banner cover -->
    <img style="object-position:top;object-fit:cover;" alt="banner" class="trm-banner-cover" src="/img/banner.png">
    <!-- banner cover end -->
    

    <!-- banner content -->
    <div class="trm-banner-content trm-overlay">
        <div class="container">
            <div class="row">
                
                <div class="col-lg-4"></div>
                
                <div class="col-lg-8">

                    <!-- banner title -->
                    <div class="trm-banner-text ">
                        <div class="trm-label trm-mb-20">
                            NEWS LETTER
                        </div>
                        <h1 class="trm-mb-30 trm-hsmb-font">
                            四、OSI第三层：数据链路层
                        </h1>

                        
                            <ul class="trm-breadcrumbs trm-label">
                                <li>
                                    <a href="/" class="trm-anima-link">Home</a>
                                </li>
                                <li>
                                    <span>
                                        2025
                                    </span>
                                </li>
                            </ul>
                        
                    </div>
                    <!-- banner title end -->

                    <!-- scroll hint -->
                    <span id="scroll-triger" class="trm-scroll-hint-frame">
                        <div class="trm-scroll-hint"></div>
                        <span class="trm-label">Scroll down</span>
                    </span>
                    <!-- scroll hint end -->

                </div>
            </div>
        </div>
    </div>
    <!-- banner content end -->
</div>
    <!-- banner end -->
    <div class="container">
        <div class="row">
            
                <div class="trm-page-sidebar col-lg-4 hidden-sm">
                    <!-- main card -->
                    <div class="trm-main-card-frame trm-sidebar">
    <div class="trm-main-card"> 
        <!-- card header -->
<div class="trm-mc-header">
    <div class="trm-avatar-frame trm-mb-20">
        <img alt="Avatar" class="trm-avatar" src="/assets/avatar.jpg">
    </div>
    <h5 class="trm-name trm-mb-15">
        Universe Hamster
    </h5>
    
</div>
<!-- card header end -->
        <!-- sidebar social -->

<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<div class="trm-social">
    
        <a href="https://github.com/zhangkeyaoo" title="github" rel="nofollow" target="_blank">
            <i class="iconfont fab fa-github"></i>
        </a>
    
        <a href="https://space.bilibili.com/28526670?spm_id_from=333.1007.0.0" title="bilibili" rel="nofollow" target="_blank">
            <i class="iconfont fas fa-bold"></i>
        </a>
    
        <a href="/assets/wechat.png" title="wechat" rel="nofollow" target="_blank">
            <i class="iconfont fab fa-weixin"></i>
        </a>
    
</div>

<!-- sidebar social end -->
        <!-- info -->
<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<ul class="trm-table trm-mb-20">
    
        <li>
            <div class="trm-label">
                school:
            </div>
            <div class="trm-label trm-label-light">
                Nanjing University
            </div>
        </li>
    
        <li>
            <div class="trm-label">
                birth:
            </div>
            <div class="trm-label trm-label-light">
                2005.06.15
            </div>
        </li>
    
        <li>
            <div class="trm-label">
                email:
            </div>
            <div class="trm-label trm-label-light">
                231250159@smail.nju.edu.cn
            </div>
        </li>
    
        <li>
            <div class="trm-label">
                qq:
            </div>
            <div class="trm-label trm-label-light">
                3313720023
            </div>
        </li>
    
</ul>
<!-- info end -->

        
    <div class="trm-divider trm-mb-40 trm-mt-40"></div>
    <!-- action button -->
    <div class="text-center">
        <a href="mailto:231250159@smail.nju.edu.cn" class="trm-btn">
            Contact Me
            <i class="iconfont far fa-envelope"></i>
        </a>
    </div>
    <!-- action button end -->

    </div>
</div>
                    <!-- main card end -->
                </div>
            
            <div class="trm-page-content col-lg-8">
                <div id="trm-content" class="trm-content">
                    <div class="trm-post-info row hidden-sm">
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-calendar-alt trm-icon"></i><br>
            02/24
        </div>
    </div>
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-clock trm-icon"></i><br>
            17:32
        </div>
    </div>
    <div class="col-sm-4">
        <div id="post-author" class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-user trm-icon"></i><br>
            Zhang Keyaoo
        </div>
    </div>
</div>
<div class="trm-card ">
    <article id="article-container" class="trm-publication">
    <h1 id="第三层：网络层"><a href="#第三层：网络层" class="headerlink" title="第三层：网络层"></a>第三层：网络层</h1><ul>
<li>Overview of the Network Layer</li>
<li>IP Addresses and Subnets</li>
<li>Layer 3 Devices </li>
<li>ARP Protocol</li>
<li>Network Layer Services</li>
<li>Routed and Routing Protocols</li>
<li>VLSM</li>
<li>ICMP</li>
<li>为什么我们不用硬件地址进行通信?<ol>
<li>(设备数量问题)因为设备比较多，供应商也比较多</li>
<li>(规格问题)不同供应商的解决方案不同，所以使用硬件地址进行通信的通用性比较低。</li>
<li>(寻址问题)全球设备太多，如果使用硬件设备，那么进行定位比较复杂</li>
</ol>
<ul>
<li>因为如上情况我们选择使用IP地址(逻辑地址)。</li>
</ul>
</li>
</ul>
<h1 id="一、网络层概述"><a href="#一、网络层概述" class="headerlink" title="一、网络层概述"></a>一、网络层概述</h1><h2 id="1-第三层职责"><a href="#1-第三层职责" class="headerlink" title="1. 第三层职责"></a>1. 第三层职责</h2><ol>
<li><strong>通过网络移动数据</strong></li>
<li>使用<strong>分层寻址 hierarchical addressing</strong>方案(与MAC寻址相反，后者平坦)<ul>
<li>分层寻址（Hierarchical Addressing）是一种网络地址分配和管理方法，它将地址空间划分为多个层次，每个层次都有不同的作用和范围（网络+子网+主机）。</li>
</ul>
</li>
<li><strong>分段网络</strong>（segment network）和<strong>控制流量</strong>（control flow of traffic）<ul>
<li>根据网络的大小和流量需求，将大型网络分割成多个较小的子网络（子网）。这些子网通常使用子网掩码来划分。</li>
</ul>
</li>
<li><strong>减少交通拥堵</strong>（Reduce congestion）</li>
<li><strong>与其它网络通信</strong></li>
</ol>
<h2 id="2-Devices"><a href="#2-Devices" class="headerlink" title="2. Devices"></a>2. Devices</h2><ul>
<li><strong>Routers</strong>（重点！）<ul>
<li><strong>互连</strong>网段或网络(不同网段的分割)</li>
<li>根据<strong>IP地址</strong>做出合理的<strong>决定</strong></li>
<li>确定<strong>最佳路径</strong>（根据<strong>路由表</strong>）</li>
<li>将<strong>数据包</strong>从入站端口切换到<strong>出站端口</strong></li>
</ul>
</li>
</ul>
<h1 id="二、IP地址和子网划分-IP-Addresses-and-Subnets"><a href="#二、IP地址和子网划分-IP-Addresses-and-Subnets" class="headerlink" title="二、IP地址和子网划分(IP Addresses and Subnets)"></a>二、IP地址和子网划分(IP Addresses and Subnets)</h1><h2 id="1-Layer-3-Packet-Datagram-第三层数据报格式"><a href="#1-Layer-3-Packet-Datagram-第三层数据报格式" class="headerlink" title="1. Layer 3 Packet&#x2F;Datagram 第三层数据报格式"></a>1. Layer 3 Packet&#x2F;Datagram 第三层数据报格式</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-7.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ul>
<li>IP地址在报文中占据一部分(一个IP地址32bit)</li>
</ul>
<h2 id="2-IPv4报文主要结构"><a href="#2-IPv4报文主要结构" class="headerlink" title="2. IPv4报文主要结构"></a>2. IPv4报文主要结构</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li><strong>首部部分</strong>：上面蓝框部分的整体<ul>
<li><strong>固定部分+可变部分</strong></li>
</ul>
</li>
<li><strong>版本号</strong>:占 <strong>4 bit</strong>，指IP协议的版本。目前的 IP 协议版本号为 <strong>4</strong> (即 IPv4)(6也就对应IPv6)</li>
<li><strong>首部长度</strong>:占 <strong>4 bit</strong>，可表示的最大数值是15个单位(一个单位为 4 字节)， 因此IP的首部长度的最大值是<strong>60字节（15个单位）</strong>。<ul>
<li>首部长度不确定，所以需要进行标识</li>
<li>4bit-&gt;15个单位；</li>
<li>首部长度的32 bit为一行，也就是4个字节为一个单位</li>
</ul>
</li>
<li><strong>服务类型</strong>:占<strong>8 bit</strong>，用来获得更好的服务，这个字段以前一直没有被人们使用。</li>
<li><strong>总长度</strong>:占 <strong>16 bit</strong>，指<strong>首部和数据之和</strong>的长度，单位为字节，因此数据报的最大长度为 <strong>65535 字节</strong>(由于放到帧里面，所以大多数不比1500字节长)。总长度必须不超过最大传送单元 MTU。</li>
<li><strong>标识</strong>(identification):占 <strong>16 bit</strong>，它是一个计数器，用来产生数据报的标识。</li>
<li><strong>标志</strong>：占 <strong>3 bit</strong>，最高位为 0;<ul>
<li>MF（More fragement）：MF 为 0 表示最后一个分片；1 是指后面还有分片</li>
<li>DF（Don’t fragement）：是否允许做分片，0 允许做分片，1 不允许做分片</li>
</ul>
</li>
<li><strong>片偏移</strong> (<strong>13 bit</strong>) 指出：较长的分组在分片后某片<em>在原分组中的相对位置</em>。<ul>
<li>片偏移以<strong>8个字节</strong>为<strong>偏移单位</strong><ul>
<li>分片：由于网络中传输的数据报可能会超过某些网络的最大传输单元（MTU），因此需要将较大的数据报分成多个较小的片段进行传输。</li>
<li>片偏移字段帮助接收方正确地<em>重组</em>这些片段。</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li>报文分片举例<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-8.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'><br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-9.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
<ol start="9">
<li><strong>生存时间</strong>：<strong>8 bit</strong>，记为 TTL (Time To Live)，表示<strong>数据报在网络中可通过的路由器数的最大值</strong>。<ul>
<li>是通过计数的方式来进行统计</li>
<li>最大值是255(最多经过255个路由器)</li>
<li>路由器每转发一次，就会对生存时间-1</li>
<li>减小为0后，就会丢弃掉，并且通知给发送方我已经丢弃掉这个报文。</li>
<li>防止在环上进行传输，避免由于回路问题，造成过大的网络资源浪费</li>
</ul>
</li>
<li><strong>协议</strong>：<strong>8 bit</strong>，协议字段指出此数据报<em>携带的数据使用何种协议</em> ，以便目的主机的IP层将数据部分上交给哪个处理过程<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-1.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
<li><strong>首部检验和</strong>:<strong>(16 bit)<strong>只检验数据报的</strong>首部</strong>，不包括数据部分。<ul>
<li>这里不采用 CRC 检验码而采用简单的计算方法。算法过程如下(比较形式化的问题，并不能解决数据报错误的形式)<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-2.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
</li>
<li><strong>源地址和目的地址</strong>都各占 4 字节（32 bit）</li>
</ol>
<h2 id="3-网络层地址-Network-Layer-Addresses"><a href="#3-网络层地址-Network-Layer-Addresses" class="headerlink" title="3. 网络层地址 Network Layer Addresses"></a>3. 网络层地址 Network Layer Addresses</h2><ol>
<li><strong>IP地址</strong>为<strong>32位长</strong>（32 bits long）</li>
<li>它们以<em>点分十进制格式</em>表示为<strong>四个(八位)字节</strong>：133.14.17.0<ul>
<li>点分十进制：用十进制表示每个字节的值，然后用点（.）分隔这些字节</li>
</ul>
</li>
<li>IP地址包含两个组成部分：<ul>
<li><strong>网络ID(The network ID)</strong><ul>
<li>由ARIN（American Registry for Internet Numbers，<a target="_blank" rel="noopener" href="http://www.arin.net)分配/">www.arin.net）分配</a></li>
<li>标识设备所连接(attached)的网络</li>
<li>可以由前三个八位位组(octets)中的一个，两个或三个来标识</li>
</ul>
</li>
<li><strong>主机ID(The host ID)</strong><ul>
<li>由网络管理员分配</li>
<li>识别该网络上的特定设备</li>
<li>可以由最后三个八位位组中的一个，两个或三个来标识</li>
</ul>
</li>
<li><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-3.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
</li>
</ol>
<h2 id="4-IP地址"><a href="#4-IP地址" class="headerlink" title="4. IP地址"></a>4. IP地址</h2><ol>
<li>不同的类地址为地址的网络部分和主机部分保留不同数量的位<ul>
<li>N是Net ID,H 是 Host ID</li>
</ul>
<ol>
<li>A: NHHH</li>
<li>B: NNHH</li>
<li>C: NNNH<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-4.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ol>
</li>
</ol>
<h3 id="4-1-分类"><a href="#4-1-分类" class="headerlink" title="4.1 分类"></a>4.1 分类</h3><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-10.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ul>
<li>IP 地址主要通过<strong>第一个字节</strong>进行划分</li>
</ul>
<ol>
<li><strong>0–127</strong> （0xxxxxxx）：Class A address</li>
<li><strong>128-191</strong> （10xxxxxx）：Class B address</li>
<li><strong>192–223</strong> （110xxxxx）：Class C address</li>
<li>224–239 （1110xxxx）：Class D – Multicast 多播地址</li>
<li>240–255 （1111xxxx）：Class E - Research 研究地址</li>
</ol>
<ul>
<li><strong>host 不能全取 0，也不能全取 1</strong>。<ul>
<li>全取 0 时用来标识网段地址</li>
<li>全取 1 时用来标识网段的广播地址</li>
</ul>
</li>
</ul>
<h3 id="4-2-主机-Hosts-的数量"><a href="#4-2-主机-Hosts-的数量" class="headerlink" title="4.2 主机(Hosts)的数量"></a>4.2 主机(Hosts)的数量</h3><ul>
<li>每个类别的最大主机数量各不相同。（不包含网络号）</li>
</ul>
<ol>
<li>A 类拥有 16,777,214 个可用主机（<strong>2^24 - 2</strong>）</li>
<li>B 类具有 65,534 个可用主机（<strong>2^16 - 2</strong>）</li>
<li>C 类具有 254 个可用主机（<strong>2^8 -2</strong>）</li>
</ol>
<ul>
<li>为什么每一类地址中都要减去 2？<ul>
<li>每个网络中的<strong>第一个地址</strong>都保留用于<strong>该网络地址</strong>（全取1）<ul>
<li><strong>最后是.0</strong></li>
</ul>
</li>
<li><strong>最后一个地址</strong>是为<strong>广播地址</strong>保留的（全取1）。<ul>
<li><strong>最后是.255</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-3-保留-Reserved-地址"><a href="#4-3-保留-Reserved-地址" class="headerlink" title="4.3 保留(Reserved)地址"></a>4.3 保留(Reserved)地址</h3><ol>
<li><strong>网络地址</strong>：在地址的<strong>主机部分</strong>中<strong>以二进制 0 结尾</strong>的 IP 地址<ul>
<li>A 类网络地址示例：113.0.0.0</li>
<li>网络上的主机只有具有相同网络 ID 的其他主机才能直接通信。（用来确定是不是在一个网段里面）</li>
</ul>
</li>
<li><strong>广播地址</strong>：用于将数据发送到网络上的所有设备。（一般是一个网段之间的）<ul>
<li>广播 IP 地址在地址的<strong>主机部分</strong>中<strong>以二进制 1 结尾</strong>。</li>
<li>B 类地址的广播地址的示例：176.10.255.255（decimal 255 &#x3D; binary 11111111）</li>
</ul>
</li>
</ol>
<ul>
<li>类别示例</li>
</ul>
<ol>
<li>Class A<ul>
<li>99.0.0.0： a reserved network number</li>
<li>99.255.255.255： a broadcast number</li>
</ul>
</li>
<li>Class B<ul>
<li>156.1.0.0： a reserved network number</li>
<li>156.1.255.255： a broadcast number</li>
</ul>
</li>
<li>Class C<ul>
<li>203.1.17.0： a reserved network number</li>
<li>203.1.17.255：a broadcast number</li>
</ul>
</li>
</ol>
<h4 id="私有地址空间-Private-Address-Space"><a href="#私有地址空间-Private-Address-Space" class="headerlink" title="私有地址空间 Private Address Space"></a>私有地址空间 Private Address Space</h4><ul>
<li>私有IP地址是指在<strong>内部网络中使用的IP地址</strong>，这些地址在互联网中是不可路由的。</li>
<li>私有IP地址用于<strong>局域网（LAN）中的设备之间的通信</strong>，<strong>避免了公共IP地址的浪费</strong>。</li>
<li>私有IP地址与公网IP地址的区别：<ul>
<li>公网IP地址是<strong>唯一的、全球可访问</strong>的IP地址，用于设备之间的互联互通。</li>
<li>私有IP地址是<strong>保留给内网使用的</strong>，不会在互联网中传递，因此它们在全球范围内<strong>不唯一</strong>。多个不同的私有网络可以使用相同的私有IP地址范围。</li>
</ul>
</li>
<li>私有IP地址范围由IANA（互联网号码分配机构）定义，常见的私有IP地址范围包括：</li>
</ul>
<ol>
<li><strong>10.0.0.0 - 10.255.255.255</strong></li>
<li><strong>172.16.0.0 - 172.31.255.255</strong></li>
<li><strong>192.168.0.0 - 192.168.255.255</strong></li>
</ol>
<ul>
<li>**IP地址耗尽（IP address depletion）**及其解决方案：<ul>
<li>NAT（网络地址转换）<ul>
<li>通过在路由器或防火墙上将私有网络的IP地址转换为公网IP地址，使得多个内网设备可以共享一个公网IP地址访问互联网。</li>
</ul>
</li>
<li>CIDR（无类别域间路由）<ul>
<li>一种更灵活的IP地址分配方法，它突破了传统的类A、类B、类C的限制，通过可变子网掩码（VLSM）来实现更精细的IP地址划分，从而提高IP地址的利用率，延缓了IPv4地址的枯竭。</li>
</ul>
</li>
<li>IPv6<ul>
<li>是IPv4的继任者，采用128位的地址格式</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="5-Subnet-子网"><a href="#5-Subnet-子网" class="headerlink" title="5. Subnet(子网)"></a>5. Subnet(子网)</h2><ul>
<li>网络管理员有时需要<strong>将网络划分为较小的网络</strong>，称为<strong>子网 subnet</strong>，以提供额外的灵活性.</li>
<li>从主机字段借来的位被指定为<strong>子网字段（Subnet Fields）</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">借的是Host字段从左往右开始数的位数！！</span><br><span class="line">Netwoek|Subnet|Host</span><br></pre></td></tr></table></figure>
<p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-11.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<h3 id="5-1-Basics-of-Subnetting"><a href="#5-1-Basics-of-Subnetting" class="headerlink" title="5.1.Basics of Subnetting"></a>5.1.Basics of Subnetting</h3><ul>
<li>子网是网络的更小划分，提供<strong>地址灵活性</strong>。</li>
<li>子网地址是<strong>本地分配</strong>的，通常由网络管理员分配。</li>
<li>子网<strong>减少了广播域</strong>。</li>
</ul>
<h3 id="5-2-How-many-bits-can-I-borrow-可以借多少位给子网"><a href="#5-2-How-many-bits-can-I-borrow-可以借多少位给子网" class="headerlink" title="5.2.How many bits can I borrow(可以借多少位给子网)"></a>5.2.How many bits can I borrow(可以借多少位给子网)</h3><ul>
<li>可以借用的<strong>最小位数</strong>是<strong>2</strong>。<ul>
<li>如果只借用 1 位以创建一个子网，那么将只有一个<strong>网络号</strong>&lt;.0 网络&gt;和<strong>广播号</strong>&lt;.1 网络&gt;，没有可以使用的专用网络。</li>
<li>两位的时候，01 和 10 给 Host，00 表示网络 ID，11 表示广播地址</li>
<li>全 0 可能导致误判</li>
</ul>
</li>
<li>最大位数:<strong>保留至少2位主机号</strong>的<strong>任何</strong>数字<ul>
<li>原因也同上<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-5.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
</li>
</ul>
<h3 id="5-3-子网划分的副产品：地址浪费Waste-Addresses"><a href="#5-3-子网划分的副产品：地址浪费Waste-Addresses" class="headerlink" title="5.3.子网划分的副产品：地址浪费Waste Addresses"></a>5.3.子网划分的副产品：地址浪费Waste Addresses</h3><ul>
<li>我们必须在<strong>所需的子网数</strong>，<strong>每个子网可接受的主机</strong>以及<strong>地址的浪费</strong>之间取得平衡（strike a balance）。</li>
<li>hostID 里面的全 0 和全 1 不能使用</li>
<li>subnet 不可以使用全 0 和全 1</li>
<li>借用 4 位是最高效率的，提升了划分灵活性，影响了效率</li>
<li>C类例图<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-6.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
<ol>
<li><strong>（C类）</strong> 借用n位，则有了<strong>2^n-2个子网</strong>，每个子网可以有<strong>2^(8-n)-2台主机</strong>(host)<ul>
<li><strong>主机总数量&#x3D;子网数×每个子网的主机数</strong></li>
<li><strong>使用率&#x3D;主机总数量&#x2F;255</strong></li>
</ul>
</li>
</ol>
<h3 id="5-4-Subnet-Mask子网掩码"><a href="#5-4-Subnet-Mask子网掩码" class="headerlink" title="5.4 Subnet Mask子网掩码"></a>5.4 Subnet Mask子网掩码</h3><ul>
<li>把<strong>网络位全赋值为 1</strong>，<strong>host 位全部赋值为 0</strong>，这样我们就明白哪些位上面是 net，哪些位上面是 host</li>
</ul>
<ol>
<li>别名：扩展网络前缀</li>
<li>定义我们用来<strong>构建网络</strong>的位数，以及<strong>描述主机地址</strong>的位数</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- Class A 255.0.0.0</span><br><span class="line">- Class B 255.255.0.0</span><br><span class="line">- Class C 255.255.255.0</span><br></pre></td></tr></table></figure>
<h2 id="6-计算子网"><a href="#6-计算子网" class="headerlink" title="6. 计算子网"></a>6. 计算子网</h2><p>例子: </p>
<ul>
<li>我们将对IP地址进行子网划分：<ul>
<li>223.14.17.0</li>
</ul>
</li>
<li>需要：13个子网，每个子网10台主机</li>
</ul>
<h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h3><ol>
<li>确定默认的子网掩码<ul>
<li>C类：192~223，所以此IP地址在C类</li>
</ul>
</li>
<li>C 类网络的默认子网掩码是：255.255.255.0</li>
</ol>
<h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><ol>
<li>通过从主机 ID 借用位来计算子网和主机的实际数量<ul>
<li>13 subnets</li>
<li>10 hosts on each subnet</li>
</ul>
<ol>
<li>2^4-2&#x3D;14，由此：子网借4位</li>
<li>每个子网10个主机, 也是至少需要4位(2^4 - 2 &#x3D;14), 主机位数为4位</li>
</ol>
</li>
<li>我们对每一个子网需要<strong>借用 4 位</strong>来满足一个子网有 <strong>10 台可用的主机</strong>。</li>
</ol>
<h3 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h3><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-12.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>产生16个子网和每个子网16台主机<ul>
<li>对于借用的 4 位，每个位可以是 1 或 0，从而有 16 种可能的组合。</li>
<li>4 个剩余主机位也是如此。</li>
</ul>
</li>
<li>【重要】<strong>每个子网上只有14个可用子网和14台主机</strong><ol>
<li>因为不能使用<strong>第一个和最后一个子网</strong>。（即全 0 和全 1）</li>
<li>因为不能使用<strong>每个子网中的第一个和最后一个地址</strong>。</li>
</ol>
<ul>
<li>对于每个，一个是广播地址，一个是网络地址。</li>
</ul>
</li>
</ol>
<h3 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4"></a>Step 4</h3><ol>
<li>确定子网掩码。<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-13.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
<li>其中<strong>X表示用于子网划分的借用位</strong>。</li>
</ol>
<ul>
<li>将<strong>X的位值相加</strong>，得到子网掩码的最后一个八位字节的十进制值：128 + 64 + 32 + 16 &#x3D; 240<ul>
<li>也等于255-15</li>
</ul>
</li>
<li>子网掩码是：<strong>255.255.255.240</strong></li>
<li>子网掩码用于<strong>显示IP地址中的子网和主机地址字段</strong></li>
</ul>
<h3 id="Step-5"><a href="#Step-5" class="headerlink" title="Step 5"></a>Step 5</h3><ol>
<li>确定主机地址的范围<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-14.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'><br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-15.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
<li>16个子网，14个可用子网</li>
<li>每个子网16个主机，14个可用主机</li>
</ol>
<h2 id="7-计算子网网络地址"><a href="#7-计算子网网络地址" class="headerlink" title="7. 计算子网网络地址"></a>7. 计算子网网络地址</h2><ol>
<li>第一步：将 <strong>IP 主机地址</strong>转换为<strong>二进制</strong>。</li>
<li>第二步：将<strong>子网掩码</strong>转换为<strong>二进制</strong>。</li>
<li>第三步：使用<strong>布尔运算符 AND</strong> 将两者进行运算。</li>
<li>第四步：将网络二进制地址<strong>转换为点分十进制</strong>。<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-16.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ol>
<ul>
<li>这是<em>子网的<strong>网络地址</strong></em></li>
<li>它可以帮助确定路径（即<strong>发送到哪一个具体的子网（网段）</strong>）：用来确定是否是一个网段，是否可以通过网关进行转发</li>
</ul>
<h3 id="7-1-路由器与IP地址"><a href="#7-1-路由器与IP地址" class="headerlink" title="7.1 路由器与IP地址"></a>7.1 路由器与IP地址</h3><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-17.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ul>
<li>为了找到子网的网络 ID，路由器必须采用 <strong>IP 地址</strong>和<strong>子网掩码</strong>，并且在逻辑上将它们取<strong>与</strong></li>
<li>131开头，说明是B类</li>
<li>上图中的子网掩码 255.255.255.0 是 255.255.0.0 借用了 8 位产生的（而不要理解成为 C 类地址的子网掩码）</li>
</ul>
<h3 id="实践：IP寻址问题"><a href="#实践：IP寻址问题" class="headerlink" title="实践：IP寻址问题"></a>实践：IP寻址问题</h3><ul>
<li>给定195.137.92.0并且需要8个可用子网，请找到子网号，主机号范围和子网广播号。</li>
<li>借用2位会产生2个可用子网，借用3位会产生6个可用子网，因此我们<strong>借用4位</strong>才能获得14个可用子网，其中我们需要8个可用地址。</li>
<li>这将使子网掩码为255.255.255.240。 因此，网络号为195.137.92.NNNN HHHH，其中Ns代表网络扩展位(子网)，Hs代表主机号。</li>
<li>接下来，我们必须为子网编号。 4位二进制数有16种组合，但它们在最后一个八位位组中保留其位置值。</li>
<li>借用<strong>4-6位都可以</strong>，因为<strong>并没有规定子网中主机数量</strong>。<ul>
<li><strong>为什么是6位</strong>是因为<strong>一个子网中最少用2位给主机</strong>。</li>
</ul>
</li>
</ul>
<hr>
<h1 id="三、第三层设备"><a href="#三、第三层设备" class="headerlink" title="三、第三层设备"></a>三、第三层设备</h1><ul>
<li><strong>路由器</strong></li>
<li>路由器2个功能：<ol>
<li><strong>路径选择</strong></li>
<li><strong>路径转发</strong></li>
</ol>
</li>
</ul>
<h2 id="1-路径选择-Path-determination"><a href="#1-路径选择-Path-determination" class="headerlink" title="1. 路径选择 Path determination"></a>1. 路径选择 Path determination</h2><ul>
<li>路由器根据链路带宽、跳数、延迟等因素，选择数据包到达目的地路径中的下一跳。<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-18.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
<h2 id="2-IP-地址"><a href="#2-IP-地址" class="headerlink" title="2. IP 地址"></a>2. IP 地址</h2><ul>
<li>IP地址在软件中实现，指的是<strong>设备所在的网络</strong>。<ul>
<li>IP地址是网络中每个设备的<em>唯一标识符</em>。每个设备（例如电脑、手机、服务器等）在连接到网络时都会被分配一个IP地址。</li>
<li>IP地址通过软件协议来进行分配、识别和管理，而非硬件本身决定的。</li>
</ul>
</li>
<li>路由器连接网络，每个网络必须<strong>有一个唯一的网络号</strong>，以确保路由成功。<ul>
<li>路由器根据<em>IP地址</em>和<em>子网掩码</em>来判断数据包应该发送到哪个网络。</li>
</ul>
</li>
<li><strong>唯一的网络号</strong>被包含在分配给<strong>连接到该网络的每个设备的IP地址</strong>中。<ul>
<li>假设一个设备的IP地址是 192.168.1.5，并且子网掩码是 &#x2F;24，这表示：<ul>
<li>网络号是 192.168.1.0</li>
<li>主机号是 5</li>
</ul>
</li>
<li><strong>所有属于同一网络的设备的IP地址都会共享相同的网络号</strong></li>
</ul>
</li>
</ul>
<h2 id="3-路由器端口-Router-Interface"><a href="#3-路由器端口-Router-Interface" class="headerlink" title="3. 路由器端口 Router Interface"></a>3. 路由器端口 Router Interface</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-19.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>路由器端口记录了<strong>网段的 IP 地址</strong>（和连接的地方是相同的）</li>
<li>在计算<strong>需要分配的端口总数</strong>时，注意<strong>路由器端口也需要被计算上</strong></li>
</ol>
<h2 id="4-路由器发送的过程-Router-function"><a href="#4-路由器发送的过程-Router-function" class="headerlink" title="4. 路由器发送的过程 Router function"></a>4. 路由器发送的过程 Router function</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-20.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>A5 主机发送报文给 B5 主机，这个报文的 IP 地址是 B5 所在的 IP 地址，形成帧，然后放上总线。</li>
</ol>
<ul>
<li>路由器剥离由帧携带的<strong>数据链路层头部</strong>。<ul>
<li>（数据链路层头部包含<strong>源和目的地的MAC地址</strong>。）<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-21.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
</li>
</ul>
<ol start="2">
<li>路由器收到帧，然后进行理解，看到报文，知道目的地是B5(解封装)</li>
</ol>
<ul>
<li><strong>检查网络层地址以确定目的网络</strong>。<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-22.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
<ol start="3">
<li>检查自己的<strong>路由表</strong>，找到目的地对应的<strong>端口</strong></li>
</ol>
<ul>
<li>查询其<strong>路由表</strong>以确定将使用哪个<strong>接口</strong>发送数据，以便到达目的网络。<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-23.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
<ol start="4">
<li>在B1端口进行转发，形成新的帧</li>
</ol>
<ul>
<li>通过接口B1发送数据，路由器会<em>将数据封装在适当的数据链路层帧</em>中。<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-24.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
<ol start="5">
<li>形成一个全新的帧，<strong>这个帧的MAC地址是B1的MAC的地址</strong>。</li>
</ol>
<h2 id="5-路由器端口示例"><a href="#5-路由器端口示例" class="headerlink" title="5. 路由器端口示例"></a>5. 路由器端口示例</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-25.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>接口是路由器连接到网络的方式，在IP路由中也可以称为<strong>端口</strong>。</li>
<li><strong>每个接口</strong>必须有一个<strong>单独的、唯一的网络地址</strong>。<ul>
<li>比如上图中 S1 和 S2 不能是相同的 IP 地址</li>
<li>路由器的连接的网段一定要是不同的</li>
</ul>
</li>
</ol>
<h2 id="6-IP地址分配-IP-address-assignment"><a href="#6-IP地址分配-IP-address-assignment" class="headerlink" title="6. IP地址分配 IP address assignment"></a>6. IP地址分配 IP address assignment</h2><ol>
<li><strong>静态地址分配（Static addressing）</strong></li>
</ol>
<ul>
<li>为每个设备配置一个IP地址。</li>
<li>你应该保持非常详细的记录，因为使用重复的IP地址可能会导致问题。</li>
</ul>
<ol start="2">
<li><strong>动态地址分配（Dynamic addressing）</strong></li>
</ol>
<ul>
<li>有几种不同的方法可以用来动态分配IP地址：<ul>
<li>RARP: 反向地址解析协议（Reverse Address Resolution Protocol）</li>
<li>BOOTP: 引导协议（BOOTstrap Protocol）</li>
<li>DHCP: 动态主机配置协议（Dynamic Host Configuration Protocol）</li>
</ul>
</li>
</ul>
<hr>
<h1 id="四、ARP-Protocol"><a href="#四、ARP-Protocol" class="headerlink" title="四、ARP Protocol"></a>四、ARP Protocol</h1><h2 id="1-Address-Resolution-Protocol（ARP）地址解析协议"><a href="#1-Address-Resolution-Protocol（ARP）地址解析协议" class="headerlink" title="1. Address Resolution Protocol（ARP）地址解析协议"></a>1. Address Resolution Protocol（ARP）地址解析协议</h2><ol>
<li>为了使设备能够通信，<strong>发送设备</strong>需要<strong>目标设备</strong>的<strong>IP地址和MAC地址</strong>。</li>
</ol>
<ul>
<li>ARP使计算机能够找到<strong>与IP地址关联的计算机的MAC地址</strong>。</li>
</ul>
<h2 id="2-ARP示例"><a href="#2-ARP示例" class="headerlink" title="2. ARP示例"></a>2. ARP示例</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-26.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>source主机访问destination</li>
<li>不知道目的主机在哪里</li>
</ol>
<h2 id="3-ARP表的缓存"><a href="#3-ARP表的缓存" class="headerlink" title="3. ARP表的缓存"></a>3. ARP表的缓存</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-27.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>可以通过lookup命令进行。</li>
<li>在RAM里面，如果ARP没有本条目的对应MAC地址。</li>
<li>MAC地址在ARP中是有时效性的。到时间不更新不激活就会删除</li>
</ol>
<h2 id="4-ARP-操作"><a href="#4-ARP-操作" class="headerlink" title="4. ARP 操作"></a>4. ARP 操作</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-28.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>使用ARP机制</li>
<li>上图中是一个示意图</li>
<li>此时ARP table中<strong>没有缓存</strong></li>
<li>图的一个问题:目的MAC地址应该在前面，源MAC地址在后面</li>
</ol>
<ul>
<li>步骤如下</li>
</ul>
<h3 id="4-1-ARP-request"><a href="#4-1-ARP-request" class="headerlink" title="4.1 ARP request"></a>4.1 ARP request</h3><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-29.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li><strong>向目的方请求MAC地址</strong><br>2。 命令如图：<strong>广播询问</strong>找谁是这个主机，你的MAC地址是啥</li>
<li><strong>将MAC地址设置为全1，作为广播发送</strong></li>
</ol>
<h3 id="4-2-Checking"><a href="#4-2-Checking" class="headerlink" title="4.2 Checking"></a>4.2 Checking</h3><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-30.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>10.0.2.5发现不是自己的主机，那么解析到这里<strong>丢掉</strong>就行，同样会记录下来对应的发送方的MAC地址。(攻击原理)</li>
<li>10.0.2.9<strong>发现自己的MAC地址</strong>，然后形成<strong>ARP应答</strong></li>
<li>同时10.0.2.9会同时记录下A主机的MAC地址，更新到自己ARP地址中去(会记录对方的)</li>
</ol>
<h3 id="4-3-ARP-reply"><a href="#4-3-ARP-reply" class="headerlink" title="4.3 ARP reply"></a>4.3 ARP reply</h3><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-31.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>向A主机进行MAC地址应答</li>
</ol>
<h3 id="4-4-Caching"><a href="#4-4-Caching" class="headerlink" title="4.4 Caching"></a>4.4 Caching</h3><ol>
<li>A的主机将刚刚得到的目标主机的<strong>MAC地址和IP地址的映射关系</strong>存储到ARP Table中</li>
<li>然后再次形成一个数据帧发送出去即可。</li>
</ol>
<h3 id="总结-ARP协议工作原理"><a href="#总结-ARP协议工作原理" class="headerlink" title="总结 ARP协议工作原理:"></a>总结 ARP协议工作原理:</h3><ol>
<li>ARP请求:<ol>
<li>数据链路层中目标地址(MAC地址)未知, 网络层中目标地址(IP地址)已知, 广播询问IP地址为目标地址(IP地址)的主机</li>
<li>你的MAC地址是多少</li>
</ol>
</li>
<li>ARP检查<ol>
<li>目标主机发现, 这个IP地址就是自己</li>
</ol>
</li>
<li>ARP回复<ol>
<li>目标主机将自己的MAC地址回复给源主机</li>
</ol>
</li>
<li>ARP缓存<ol>
<li>将刚刚得到的目标主机的MAC地址和IP地址的映射关系存储到ARP表中</li>
</ol>
</li>
</ol>
<h2 id="5-ARP-Destination-local-目的地址为本地"><a href="#5-ARP-Destination-local-目的地址为本地" class="headerlink" title="5. ARP: Destination local 目的地址为本地"></a>5. ARP: Destination local 目的地址为本地</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-32.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ul>
<li>当目标设备在<strong>本地网络</strong>中时，ARP协议用于解析目标设备的MAC地址。</li>
<li><strong>发送设备</strong>会<strong>广播ARP请求</strong>，询问<em>目标IP地址</em> 对应的<em>MAC地址</em>。</li>
<li><strong>目标设备</strong>收到ARP请求后，会<strong>回复其MAC地址</strong>。</li>
<li>发送设备将目标设备的IP地址和MAC地址映射关系<strong>存储在ARP缓存</strong>中，以便后续通信使用。</li>
</ul>
<h2 id="6-ARP-Internetwork-Communication-网络交流"><a href="#6-ARP-Internetwork-Communication-网络交流" class="headerlink" title="6. ARP: Internetwork Communication 网络交流"></a>6. ARP: Internetwork Communication 网络交流</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-33.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>如何与<strong>不在同一物理网段上的设备</strong>通信？如下是两种解决方案。<ul>
<li>Default gateway <strong>默认网关</strong></li>
<li>Proxy ARP <strong>代理ARP</strong></li>
</ul>
</li>
</ol>
<h3 id="6-1-默认网关-Default-gateway"><a href="#6-1-默认网关-Default-gateway" class="headerlink" title="6.1 默认网关 Default gateway:"></a>6.1 默认网关 Default gateway:</h3><ul>
<li>为了使设备能够与<strong>另一个网络上</strong>的设备通信，必须为其提供一个<strong>默认网关</strong>。</li>
<li>默认网关是<strong>路由器上连接到源主机所在网络段</strong>的<strong>接口的IP地址</strong>。</li>
<li>为了使设备将数据发送到另一个网络段上的设备地址，<strong>源设备将数据发送到默认网关</strong>。</li>
</ul>
<h3 id="6-2-Proxy-ARP-代理ARP："><a href="#6-2-Proxy-ARP-代理ARP：" class="headerlink" title="6.2 Proxy ARP 代理ARP："></a>6.2 Proxy ARP 代理ARP：</h3><ul>
<li>代理ARP代理ARP是ARP的一种变体。</li>
<li>在源主机没有配置默认网关的情况下，代理ARP可以发挥作用。<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-34.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
<li>发送ARP请求，然后路由器给你一个ARP的reply，告诉你MAC地址(一般为本端口的IP地址)</li>
</ul>
<ol>
<li><strong>源主机发送ARP请求</strong>：<ul>
<li>当源主机没有配置默认网关时，它会发送ARP请求，询问目标IP地址的MAC地址。</li>
</ul>
</li>
<li><strong>路由器响应ARP请求</strong>：<ul>
<li>路由器配置了代理ARP功能，会拦截并响应这个ARP请求。</li>
<li><strong>路由器会回复其自己的MAC地址</strong>，作为目标IP地址的MAC地址。</li>
</ul>
</li>
<li><strong>源主机发送数据</strong>：<ul>
<li>源主机接收到路由器的ARP回复后，会将数据发送到路由器的MAC地址。</li>
</ul>
</li>
<li><strong>路由器转发数据</strong>：<ul>
<li>路由器接收到数据后，会根据其路由表将数据<strong>转发</strong>到目标网络上的实际目标设备。</li>
</ul>
</li>
</ol>
<h2 id="7-ARP-Destination-not-local"><a href="#7-ARP-Destination-not-local" class="headerlink" title="7. ARP: Destination not local"></a>7. ARP: Destination not local</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-35.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ul>
<li>路由器会把<strong>Router MAC</strong>的地址给你(连接本网段的MAC地址)</li>
</ul>
<h2 id="8-ARP-Flowchart-ARP流程图"><a href="#8-ARP-Flowchart-ARP流程图" class="headerlink" title="8. ARP Flowchart ARP流程图"></a>8. ARP Flowchart ARP流程图</h2><h2 id><a href="#" class="headerlink" title></a><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-36.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></h2><h1 id="五、网络层服务"><a href="#五、网络层服务" class="headerlink" title="五、网络层服务"></a>五、网络层服务</h1><h2 id="1-面向连接的网络服务-Connection-oriented"><a href="#1-面向连接的网络服务-Connection-oriented" class="headerlink" title="1. 面向连接的网络服务 Connection-oriented"></a>1. 面向连接的网络服务 Connection-oriented</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-37.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ul>
<li>在数据传输之前先建立连接</li>
</ul>
<h2 id="1-1-电路交换-Circuit-switched"><a href="#1-1-电路交换-Circuit-switched" class="headerlink" title="1.1 电路交换 Circuit-switched"></a>1.1 电路交换 Circuit-switched</h2><ol>
<li>面向连接vs电路交换<ul>
<li>这两个术语并不相同</li>
</ul>
</li>
</ol>
<ul>
<li>面向连接：首先与接收方建立连接，然后开始数据传输。</li>
<li>电路交换：所有数据包依次通过相同的通道传输，或者更常见的是，通过<strong>相同的虚拟电路</strong>传输。</li>
</ul>
<h2 id="2-无连接的网络服务-Connectionless"><a href="#2-无连接的网络服务-Connectionless" class="headerlink" title="2. 无连接的网络服务 Connectionless"></a>2. 无连接的网络服务 Connectionless</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-38.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>他们<strong>分别separately</strong>对待每个数据包。</li>
<li><strong>IP 是无连接系统</strong>。 IP 就是提供无连接的网络服务</li>
</ol>
<ul>
<li>不要求发送方和接收方在发送前先建立一个连接(不打招呼)。</li>
</ul>
<h2 id="2-1-数据包交换-Packet-switched"><a href="#2-1-数据包交换-Packet-switched" class="headerlink" title="2.1 数据包交换 Packet switched"></a>2.1 数据包交换 Packet switched</h2><ol>
<li>无连接网络vs数据包交换<ul>
<li>这两个术语并不相同</li>
</ul>
</li>
<li>当数据包从源传输到目的地时，它们可以：<ul>
<li><strong>切换</strong>到不同的<strong>路径</strong>。</li>
<li>到达<strong>顺序可能不同</strong>。</li>
</ul>
</li>
<li>设备会<strong>根据多种标准</strong>为每个数据包<strong>确定传输路径</strong>。某些标准可能会因数据包而异。</li>
</ol>
<hr>
<h1 id="六、Routed-and-Routing-protocol-路由和路由协议"><a href="#六、Routed-and-Routing-protocol-路由和路由协议" class="headerlink" title="六、Routed and Routing protocol 路由和路由协议"></a>六、Routed and Routing protocol 路由和路由协议</h1><ul>
<li>网络协议操作<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-39.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
<h2 id="1-Routed-protocol-被动可路由协议"><a href="#1-Routed-protocol-被动可路由协议" class="headerlink" title="1. Routed protocol 被动可路由协议"></a>1. Routed protocol 被动可路由协议</h2><ol>
<li>为网络层提供支持的协议称为<strong>路由协议</strong>或<strong>可路由协议</strong>。</li>
<li>IP 是网络层协议，因此，它可以通过互联网进行路由。</li>
</ol>
<h2 id="2-Non-routable-protocol-不可路由协议"><a href="#2-Non-routable-protocol-不可路由协议" class="headerlink" title="2. Non-routable protocol 不可路由协议"></a>2. Non-routable protocol 不可路由协议</h2><ol>
<li>不支持第三层</li>
<li>这些不可路由协议中最常见的是 NetBEUI。</li>
<li>NetBEUI 是一种小型，快速且高效的协议，仅限于在一个网段上运行。</li>
</ol>
<h2 id="3-被动可路由协议的寻址-Addressing-of-a-routable-protocol"><a href="#3-被动可路由协议的寻址-Addressing-of-a-routable-protocol" class="headerlink" title="3. 被动可路由协议的寻址 Addressing of a routable protocol"></a>3. 被动可路由协议的寻址 Addressing of a routable protocol</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-40.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'><br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-41.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ul>
<li>路由器连接三个网段(列出来的是网络号)</li>
</ul>
<ol>
<li>目的主机131.108.2.2</li>
<li>将目的主机和掩码进行逻辑AND操作，得到对应的网段，为131.108.2.0</li>
<li>请求路由表可以发现，E2端口为目的网段</li>
<li>再次将报文封装，转发给对应的主机</li>
<li>路由表是存储在内存中的</li>
</ol>
<h2 id="4-路由协议分类1：Static-and-Dynamic-静态和动态"><a href="#4-路由协议分类1：Static-and-Dynamic-静态和动态" class="headerlink" title="4. 路由协议分类1：Static and Dynamic 静态和动态"></a>4. 路由协议分类1：Static and Dynamic 静态和动态</h2><ol>
<li>静态路由 Static routes：<ul>
<li><strong>网络管理员</strong>在路由器中<strong>手动输入</strong>路由信息。</li>
</ul>
</li>
<li>动态路由 Dynamic routes：<ul>
<li>路由器可以在运行过程中互相学习信息。</li>
<li>使用**路由协议 (routing protocol)**更新路由信息。</li>
<li>RIP, IGRP, EIGRP, OSPF …</li>
<li>人工维护的代价比较大</li>
</ul>
</li>
</ol>
<ul>
<li>区别：</li>
</ul>
<ol>
<li>静态路由<ul>
<li>用于隐藏部分网络。安全(不必进行路由表的交换)</li>
<li>测试网络中的特定链接。</li>
<li>用于在只有一条路径到目标网络时维护路由表。</li>
</ul>
</li>
<li>动态路由<ul>
<li>维护路由表。</li>
<li>以路由更新的形式及时分发信息。</li>
<li>依靠路由协议共享知识。</li>
<li>路由器可以调整以适应不断变化的网络状况。</li>
<li>打开后会启动进程，按照不同的协议，和网上的不同设备学习信息，然后根据算法生成路由表</li>
</ul>
</li>
</ol>
<h3 id="4-1-Routing-protocol-主动路由协议-Routing"><a href="#4-1-Routing-protocol-主动路由协议-Routing" class="headerlink" title="4.1 Routing protocol 主动路由协议(Routing)"></a>4.1 Routing protocol 主动路由协议(Routing)</h3><ol>
<li>Routing protocols <em>确定</em> routed protocols遵循的到达目的地的路径。</li>
<li>是用来<strong>构建路由表</strong>的，<strong>所以叫做routing</strong></li>
<li>公平、简单、适应变化等特点</li>
</ol>
<h3 id="4-2-Routed-vs-Routing-protocol"><a href="#4-2-Routed-vs-Routing-protocol" class="headerlink" title="4.2 Routed vs. Routing protocol"></a>4.2 Routed vs. Routing protocol</h3><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-42.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li><strong>Routed Portocol</strong> 用于路由器之间，用来保证路由器之间连通（完成转发），保证路由器有效连通。<ul>
<li><ul>
<li><strong>功能</strong>：实际承载和传输数据。</li>
</ul>
</li>
<li>示例：IP、IPX等</li>
</ul>
</li>
<li><strong>Routing Protocol</strong> 用于做各自的<strong>路由表的生成</strong>：路由器彼此交换信息。<ul>
<li><ul>
<li><strong>功能</strong>：帮助路由器构建和维护路由表。</li>
</ul>
</li>
<li>示例：RIP、OSPF、EIGRP、BGP等。</li>
</ul>
</li>
</ol>
<ul>
<li>Routing Protocol 决定 Routed Protocals</li>
</ul>
<ol start="3">
<li>简单来说，路由协议(routing)用于<strong>帮助路由器决定数据包的最佳传输路径</strong>，而路由协议(routed)是<strong>实际用于传输数据</strong>的协议。</li>
</ol>
<h2 id="5-路由协议分类2（动态路由协议）：IGP-and-EGP"><a href="#5-路由协议分类2（动态路由协议）：IGP-and-EGP" class="headerlink" title="5. 路由协议分类2（动态路由协议）：IGP and EGP"></a>5. 路由协议分类2（动态路由协议）：IGP and EGP</h2><ul>
<li>皆为动态路由</li>
</ul>
<ol>
<li><strong>内部网关协议 IGP</strong>(Interior Gateway Protocols)</li>
</ol>
<ul>
<li>示例：RIP、IGRP、EIGRP、OSPF</li>
<li>用途：在<strong>一个自治系统内</strong>使用，例如公司网络、学校网络或政府机构网络。</li>
</ul>
<ol start="2">
<li><strong>外部网关协议 EGP</strong>(Exterior Gateway Protocols)</li>
</ol>
<ul>
<li>示例：EGP、BGP</li>
<li>用途：在<strong>不同自治系统之间路由数据包</strong>，例如跨组织或跨地区的互联网连接。</li>
</ul>
<h2 id="6-路由协议分类3（内部网关协议）：DVP-and-LSP"><a href="#6-路由协议分类3（内部网关协议）：DVP-and-LSP" class="headerlink" title="6. 路由协议分类3（内部网关协议）：DVP and LSP"></a>6. 路由协议分类3（内部网关协议）：DVP and LSP</h2><ol>
<li><strong>距离矢量协议 (Distance-Vector Protocols)：RIP, IGRP</strong></li>
</ol>
<ul>
<li>从<strong>邻居的角度</strong>查看网络拓扑。</li>
<li>添加从路由器到路由器的<strong>距离+矢量</strong>。<ul>
<li>距离 (Distance)：通常是路由器与目标网络之间的<strong>跳数</strong>（hop count）。每个跳数代表从一个路由器到另一个路由器的路径。</li>
<li>矢量 (Vector)：在距离矢量协议中，矢量通常指的是<em>从源路由器到目标路由器的下一跳信息</em>。每个路由器会保存一张路由表，记录到每个目标网络的最短跳数和下一跳路由器。</li>
</ul>
</li>
<li><strong>频繁、定期periodic更新</strong>。<ul>
<li>周期性地交换路由信息来计算最佳路径<ol>
<li>到达每个目标网络的跳数（距离）。</li>
<li>用于到达目标网络的下一跳路由器（方向）。</li>
</ol>
</li>
</ul>
</li>
<li>将<strong>路由表的副本</strong>传递给邻居路由器。</li>
</ul>
<ol start="2">
<li><strong>链路状态协议 (Link State Protocols)：OSPF</strong>*</li>
</ol>
<ul>
<li>每个路由器获取<strong>整个网络拓扑</strong>的共同视图。</li>
<li><strong>计算</strong>到其他路由器的<strong>最短路径</strong>。</li>
<li><strong>事件触发更新</strong>。</li>
<li>传递<strong>链路状态路由更新</strong>到其他路由器。</li>
</ul>
<h3 id="6-1-距离矢量协议DVP的示例"><a href="#6-1-距离矢量协议DVP的示例" class="headerlink" title="6.1 距离矢量协议DVP的示例"></a>6.1 距离矢量协议DVP的示例</h3><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-43.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ul>
<li>初始的时候，各自持有的是黑色的部分（直连的线路）</li>
<li>定时路由表会相互交换给邻居，下一时刻 C 学习到 B，B 学习到 AC，A 学习到 B，在下一刻进行再次的转发。</li>
<li>DVP 只知道<strong>到达一个网段的最少跳数hops</strong>（但是不知道最佳路径）。</li>
<li>可能导致问题：生成路由回路</li>
</ul>
<h4 id="6-1-1-RIP-Route-Information-Protocol-路由信息协议"><a href="#6-1-1-RIP-Route-Information-Protocol-路由信息协议" class="headerlink" title="6.1.1 RIP (Route Information Protocol)路由信息协议"></a>6.1.1 RIP (Route Information Protocol)路由信息协议</h4><ul>
<li>最流行的协议。</li>
<li><strong>内部网关协议TGP</strong>。</li>
<li><strong>距离矢量协议DVP</strong>。</li>
<li>唯一的度量是跳数hops。</li>
<li>最大跳数为15。</li>
<li>每30秒更新一次。</li>
<li>并不总是选择最快的路径。</li>
<li>生成大量网络流量。</li>
<li>RIP v2是RIP v1的改进版本。</li>
</ul>
<h4 id="6-1-2-IGRP-Interior-Gateway-Route-Protocol-and-EIGRP-Enhanced-IGRP"><a href="#6-1-2-IGRP-Interior-Gateway-Route-Protocol-and-EIGRP-Enhanced-IGRP" class="headerlink" title="6.1.2 IGRP (Interior Gateway Route Protocol) and EIGRP (Enhanced IGRP)"></a>6.1.2 IGRP (Interior Gateway Route Protocol) and EIGRP (Enhanced IGRP)</h4><ul>
<li>IGRP（内部网关路由协议）和EIGRP（增强型IGRP）</li>
<li>Cisco专有协议。</li>
<li><strong>内部网关协议IGP</strong>。</li>
<li><strong>距离矢量协议DVP</strong>。</li>
<li>度量由带宽、负载、延迟和可靠性组成。</li>
<li>最大跳数为255。</li>
<li>每90秒更新一次。</li>
<li>EIGRP是IGRP的高级版本，是一种混合路由协议。</li>
</ul>
<h3 id="6-2-链路状态协议LSP的示例"><a href="#6-2-链路状态协议LSP的示例" class="headerlink" title="6.2 链路状态协议LSP的示例"></a>6.2 链路状态协议LSP的示例</h3><ul>
<li>下图中的 Routing table 应该叫做初始时刻的 Routing Table（本图的问题）<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-44.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
<ol>
<li>彼此交换连接情况，<strong>交换的是Link state</strong>而不是路由表，包含 link 的信息，以 NetID 作为主键（无相同网段），包含的是 link 上的路由器邻接关系、链路类型（4 种）、链路带宽，会指定谁连接了谁，这个条目就被称为 Database（表）。这样子就不仅仅知道链路，还知道更多的全局信息。</li>
<li>LSP 操作过程：<ul>
<li>相互交换彼此学到对应的 Tpological Database（是全局的信息）</li>
<li>之后使用 SPF 算法，以自己为根，通过最短路径优先算法，生成以自己为根的树</li>
<li>根据这一个树再生成路由表（了解全局的信息），逻辑是树的逻辑。</li>
</ul>
</li>
<li>LSP 不是进行定时进行交换的，而是<em>初始的时候进行交换</em>，稳定之后，根据<strong>事件触发</strong>的时候才会更新数据。<ul>
<li>更新后发送给所有的路由器，需要将 Database 发送给所有的路由器</li>
<li>收到的路由器的，根据 database 更新自己的树，然后再次生成路由表。</li>
</ul>
</li>
<li>LSP 是指从所有可达的道路上找到代价最小的路径。</li>
<li>全局可能会比较大，考虑负载进行处理</li>
<li>但是没有路由回路，单域内一般不超过 20 个路由器</li>
<li>路由表一般只保存一个最优的转发点的（负载均衡）</li>
</ol>
<h4 id="6-2-1-OSPF（Open-Shortest-Path-First）开放最短路径优先"><a href="#6-2-1-OSPF（Open-Shortest-Path-First）开放最短路径优先" class="headerlink" title="6.2.1 OSPF（Open Shortest Path First）开放最短路径优先"></a>6.2.1 OSPF（Open Shortest Path First）开放最短路径优先</h4><ul>
<li>开放最短路径优先。</li>
<li><strong>内部网关协议IGP</strong>。</li>
<li><strong>链路状态协议LSP</strong>。</li>
<li>度量由成本、速度、流量、可靠性和安全性组成。</li>
<li>事件触发更新。</li>
</ul>
<h1 id="七、VLSM-可变长度子网掩码"><a href="#七、VLSM-可变长度子网掩码" class="headerlink" title="七、VLSM 可变长度子网掩码"></a>七、VLSM 可变长度子网掩码</h1><ul>
<li>Variable Length Subnet Mask</li>
</ul>
<h2 id="1-Classful-Routing（类路由）"><a href="#1-Classful-Routing（类路由）" class="headerlink" title="1. Classful Routing（类路由）"></a>1. Classful Routing（类路由）</h2><ol>
<li>类路由协议要求<strong>一个网络</strong>使用<strong>相同的子网掩码</strong>。</li>
<li>例如：如果网络是 192.168.187.0，那么它必须使用一个单一的子网掩码，如 255.255.255.0。</li>
</ol>
<ul>
<li>也就是说，类路由协议不允许在同一个网络中存在多个子网掩码，<strong>所有子网都需要使用相同的掩码</strong>。</li>
<li>类路由的这种特性比较简单，但它不具备灵活性，无法根据需求进行更精细的子网划分。<ul>
<li>会造成一些浪费</li>
</ul>
</li>
</ul>
<h2 id="2-VLSM-—-Variable-Length-Subnet-Mask"><a href="#2-VLSM-—-Variable-Length-Subnet-Mask" class="headerlink" title="2. VLSM — Variable Length Subnet Mask"></a>2. VLSM — Variable Length Subnet Mask</h2><ol>
<li>VLSM是一种允许在<strong>同一个自治系统内使用不同子网掩码</strong>的特性。<ul>
<li>有效地解决浪费问题</li>
</ul>
</li>
<li>为什么要使用VLSM<ul>
<li>VLSM允许一个组织在同一个网络地址空间内使用多个子网掩码。</li>
<li>实施VLSM通常被称为“子网的子网”，可以用来最大化地址分配的效率。</li>
<li>VLSM是帮助弥合IPv4和IPv6之间差距的修改之一。</li>
</ul>
</li>
<li>优点<ul>
<li>高效使用IP地址 Efficient use of IP addresses</li>
<li>更好的路由聚合 Better route aggregation</li>
</ul>
</li>
<li>支持VLSM的 Routing Protocol：<ul>
<li>开放最短路径优先Open Shortest Path First (OSPF) </li>
<li>集成中间系统到中间系统 Integrated Intermediate System to Intermediate System (Integrated IS-IS) </li>
<li>增强型内部网关路由协议 Enhanced Interior Gateway Routing Protocol (EIGRP)</li>
<li>RIP v2 </li>
<li>静态路由 Static routing</li>
</ul>
</li>
<li>缺点：<ul>
<li>地址空间的浪费:广播地址和网络号都无法被使用。<ul>
<li>过去，建议不要使用第一个和最后一个子网。但从Cisco IOS 12.0版本开始，可以使用子网0。</li>
<li>从IOS 12.0版本开始，Cisco路由器默认使用子网0。</li>
</ul>
</li>
<li>如果想要禁止零子网，使用该指令:<code>router(config)#no ip subnet-zero()</code><br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-45.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
</li>
</ol>
<ul>
<li>上图解释了子网长度相同会造成怎样的浪费(在路由器所在的子网段我们只需要满足2个主机，也就是需要2位的主机号就可以完成操作)</li>
</ul>
<h2 id="3-如何使用VLSM"><a href="#3-如何使用VLSM" class="headerlink" title="3. 如何使用VLSM"></a>3. 如何使用VLSM</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-47.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ul>
<li><strong>斜杠的含义</strong>是指<strong>前面多少位保留给网络位</strong></li>
<li><strong>此时也就是&#x2F;30 就可以满足路由器之间的网络连通所需（减少浪费），剩下的网络地址可以在以后网络进行扩展</strong><ul>
<li>这个例子中不使用 VLSM 还是可以进行解决的<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-48.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
</li>
</ul>
<h3 id="3-0-划分背景"><a href="#3-0-划分背景" class="headerlink" title="3.0 划分背景"></a>3.0 划分背景</h3><ul>
<li>已分配 192.168.10.0&#x2F;24 的 C 类地址。<ul>
<li>珀斯、悉尼和新加坡有一个到吉隆坡（KL）的广域网连接。</li>
<li>珀斯需要60个主机。</li>
<li>吉隆坡需要28个主机。</li>
<li>悉尼和新加坡各需要12个主机。</li>
</ul>
</li>
</ul>
<ol>
<li>要计算 VLSM，子网和相应的主机首先从地址范围中分配<strong>最大的要求</strong>。需求级别应<strong>从大到小</strong>列出。</li>
</ol>
<h3 id="3-1-第一步：满足珀斯的主机需求（需求最大）"><a href="#3-1-第一步：满足珀斯的主机需求（需求最大）" class="headerlink" title="3.1 第一步：满足珀斯的主机需求（需求最大）"></a>3.1 第一步：满足珀斯的主机需求（需求最大）</h3><ol>
<li>珀斯需要60个主机。</li>
<li>2^6-2&#x3D;62个可用主机地址，所以使用6位<ul>
<li>将从第四个八位位组开始使用 2 位来表示&#x2F;26 的扩展网络前缀，其余 6 位将用于主机地址。</li>
</ul>
</li>
<li>在地址 192.168.10.0&#x2F;24 上应用 VLSM 可得到：<ul>
<li><strong>子网掩码：255.255.255.192</strong>（<strong>&#x2F;26</strong>）</li>
<li><strong>子网地址：192.168.10.0&#x2F;26</strong></li>
<li><strong>可用地址范围：192.168.10.1 - 192.168.10.62</strong></li>
<li><strong>广播地址: 192.168.10.63</strong><br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-49.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
</li>
</ol>
<ul>
<li>第一个给 Perth 使用，剩下的用作保留未使用的</li>
</ul>
<h3 id="3-2-第二步：为吉隆坡划分子网（需求第二）"><a href="#3-2-第二步：为吉隆坡划分子网（需求第二）" class="headerlink" title="3.2 第二步：为吉隆坡划分子网（需求第二）"></a>3.2 第二步：为吉隆坡划分子网（需求第二）</h3><ol>
<li>吉隆坡需要28个主机<ul>
<li>下一个可用地址是192.168.10.64&#x2F;26。</li>
<li><strong>01</strong>00 0000</li>
</ul>
</li>
<li>由于需要28个主机，<strong>5位</strong>将用于主机地址，2^5 - 2 &#x3D; 30个可用主机地址。</li>
<li>因此，<strong>5位用于表示主机</strong>，<strong>3位用于表示扩展网络前缀&#x2F;27</strong>。</li>
<li>在地址 192.168.10.64&#x2F;26 上应用VLSM可得到<ul>
<li>子网掩码：255.255.255.<strong>224（&#x2F;27）</strong><ul>
<li>1110 0000</li>
</ul>
</li>
<li><strong>子网地址：192.168.10.64&#x2F;27</strong><ul>
<li>192.168.10.<strong>010 hhhhh</strong> &#x2F;27</li>
</ul>
</li>
<li><strong>可用地址范围：192.168.10.65 - 192.168.10.94</strong></li>
<li><strong>广播地址：192.168.10.95</strong><br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-50.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
</li>
</ol>
<h3 id="3-3-第三步：为悉尼和新加坡进行分配地址（需求第三）"><a href="#3-3-第三步：为悉尼和新加坡进行分配地址（需求第三）" class="headerlink" title="3.3 第三步：为悉尼和新加坡进行分配地址（需求第三）"></a>3.3 第三步：为悉尼和新加坡进行分配地址（需求第三）</h3><ol>
<li>悉尼和新加坡各需要12个主机：<ul>
<li>下一个可用地址是192.168.10.96&#x2F;27。</li>
</ul>
</li>
<li>由于需要12个主机，<strong>4位</strong>将用于主机地址，2^4 &#x3D; 16，16 - 2 &#x3D; 14个可用主机地址。</li>
<li>因此，<strong>4位用于表示主机</strong>，4位用于表示扩展<strong>网络前缀&#x2F;28</strong>。</li>
<li>在地址 192.168.10.96&#x2F;27 上应用 VLSM 可得到：<ul>
<li>子网掩码：255.255.255.<strong>240（&#x2F;28）</strong><ul>
<li>1111 0000</li>
</ul>
</li>
<li><strong>子网地址：192.168.10.96&#x2F;28</strong><ul>
<li>192.168.10.<strong>0110 hhhh</strong>&#x2F;28</li>
</ul>
</li>
<li><strong>可用地址范围：192.168.10.97 - 192.168.10.110</strong></li>
<li><strong>广播地址：192.168.10.111</strong></li>
</ul>
</li>
</ol>
<ul>
<li>新加坡同理（12个主机）：<ul>
<li>下一个可用地址是192.168.10.112&#x2F;28</li>
<li>需要12个主机——4位表示主机，4位表示扩展网络前缀</li>
</ul>
</li>
</ul>
<ol start="5">
<li>在地址192.168.10.112&#x2F;28上应用VLSM得到：<ul>
<li>子网掩码：255.255.255.<strong>240（&#x2F;28）</strong><ul>
<li>1111 0000</li>
</ul>
</li>
<li>子网地址：192.168.10.112&#x2F;28<ul>
<li>192.168.10.<strong>0111</strong> hhhh&#x2F;28</li>
</ul>
</li>
<li>可用地址范围：192.168.10.113 - 192.168.10.126</li>
<li>广播地址：192.168.10.127<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-51.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
</li>
</ol>
<h3 id="3-4-第四步：为之间的路由地址进行划分"><a href="#3-4-第四步：为之间的路由地址进行划分" class="headerlink" title="3.4 第四步：为之间的路由地址进行划分"></a>3.4 第四步：为之间的路由地址进行划分</h3><ol>
<li>现在为 WAN 连接分配地址。请记住，<strong>每个 WAN 连接都需要两个 IP 地址</strong>。<ul>
<li>下一个可用的子网是 192.168.10.128&#x2F;28。</li>
</ul>
</li>
<li>由于每个 WAN 链路需要 2 个网络地址，因此主机地址需要 2 位，即 2^2 -2 &#x3D; 2 个可用地址。</li>
<li>因此，2位用于表示链接，6位用于表示扩展网络前缀&#x2F;30。</li>
<li>在 192.168.10.128&#x2F;28 上应用 VLSM 可得到：<ul>
<li>子网掩码：255.255.255.252（&#x2F;30）<ul>
<li>1111 1100</li>
</ul>
</li>
<li>子网地址：192.168.10.128&#x2F;30<ul>
<li>192.168.10.<strong>011000</strong> hh &#x2F;30</li>
</ul>
</li>
<li>可用地址范围：192.168.10.129 - 192.168.10.130</li>
<li>广播地址：192.168.10.131<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-52.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'><br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-53.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
</li>
<li><strong>下一个WAN链接</strong>：<ul>
<li>子网地址：192.168.10.132&#x2F;30</li>
<li>可用地址范围：192.168.10.133 - 192.168.10.134</li>
<li>广播地址：192.168.10.135</li>
</ul>
</li>
<li><strong>下一个WAN链接</strong>：<ul>
<li>子网地址：192.168.10.136&#x2F;30</li>
<li>可用地址范围：192.168.10.137 - 192.168.10.138</li>
<li>广播地址：192.168.10.139</li>
</ul>
</li>
</ol>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><ul>
<li><strong>重要的是要记住，只有未使用的子网才能进一步子网划分。</strong></li>
<li>如果子网中的任何地址已被使用，则该子网不能进一步子网划分。</li>
<li>一般是从<strong>主机多到主机少</strong>（路由间网络）进行划分</li>
<li>最后<strong>不要忘了路由地址的划分</strong></li>
</ul>
<h2 id="4-Route-Aggregation-路由聚合"><a href="#4-Route-Aggregation-路由聚合" class="headerlink" title="4. Route Aggregation 路由聚合"></a>4. Route Aggregation 路由聚合</h2><ol>
<li>使用<strong>无类域间路由</strong>(<strong>CIDR</strong>，Classless InterDomain Routing)和<strong>VLSM</strong>不仅可以防止地址浪费，而且还可以促进路由聚合或汇总。</li>
<li>路由聚合（也称为路由汇总）是一种将<strong>多个连续的IP地址块</strong>合并为<strong>一个单一的路由条目</strong>的技术。<ul>
<li>通过路由聚合，可以减少路由表中的条目数量，从而简化路由器的处理和提高网络效率。</li>
</ul>
</li>
<li>优点：<ol>
<li>减少<strong>路由表</strong>条目的数量。</li>
<li>可用于<strong>隔离拓扑更改</strong><ul>
<li>当网络拓扑发生变化时，路由聚合可以帮助隔离这些变化，减少对整个网络的影响。</li>
</ul>
</li>
</ol>
</li>
<li>为了使路由聚合正常工作，需要以<strong>层次化</strong>的方式仔细分配地址，以确保<strong>汇总地址能够共享相同的高阶位</strong>（高位部分）。</li>
<li>VLSM可以通过基于地址的**高阶位（左边高位部分）**来实现路由的汇总和灵活性，即使网络地址不一定是连续的。</li>
</ol>
<ul>
<li>比如下图：3个&#x2F;24的子网合并成一个&#x2F;16的网络高速远端<br><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-54.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></li>
</ul>
<h3 id="4-0-例子"><a href="#4-0-例子" class="headerlink" title="4.0 例子"></a>4.0 例子</h3><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-55.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<h3 id="4-1-如何进行路由聚合"><a href="#4-1-如何进行路由聚合" class="headerlink" title="4.1 如何进行路由聚合"></a>4.1 如何进行路由聚合</h3><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-56.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ul>
<li>将尽可能多的位进行聚集，将之后的不通过的位置，作为 Host 位，就得到了上图的结果</li>
</ul>
<hr>
<h1 id="八、ICMP-因特网控制报文协议"><a href="#八、ICMP-因特网控制报文协议" class="headerlink" title="八、ICMP 因特网控制报文协议"></a>八、ICMP 因特网控制报文协议</h1><ol>
<li>ICMP (<strong>Internet Control Message Protocol</strong>)：为了提高<br>IP 数据报交付成功的机会</li>
<li>ICMP 允许主机或路由器<strong>报告差错情况</strong>和提供有关异常情况<br>的报告</li>
<li>ICMP 只是IP 层的协议</li>
<li>ICMP 报文作为IP 层数据报的数据，加上数据报的首部，组成IP 数据报发送出去</li>
</ol>
<h2 id="1-ICMP-报文的格式"><a href="#1-ICMP-报文的格式" class="headerlink" title="1. ICMP 报文的格式"></a>1. ICMP 报文的格式</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-57.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>前4个字节和普通数据报的格式一样<ul>
<li>类型</li>
<li>代码</li>
<li>检验和</li>
</ul>
</li>
<li>后面都是要根据类型</li>
</ol>
<h2 id="2-两种ICMP报文"><a href="#2-两种ICMP报文" class="headerlink" title="2. 两种ICMP报文"></a>2. 两种ICMP报文</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-58.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>查询报文：一般这种情况不是很多</li>
<li>差错报告报文：一般这种类型会多一些</li>
</ol>
<h2 id="3-目的站不可到达"><a href="#3-目的站不可到达" class="headerlink" title="3. 目的站不可到达"></a>3. 目的站不可到达</h2><ul>
<li><p>网络不可到达（net unreachable）</p>
</li>
<li><p>主机不可到达（host unreachable）</p>
</li>
<li><p>协议不可到达（protocol unreachable）</p>
</li>
<li><p>端口不可到达（port unreachable）</p>
</li>
<li><p>源路由选择不能完成（source route failed）</p>
</li>
<li><p>目的网络不可知（unknown destination network）</p>
</li>
<li><p>目的主机不可知（unknown destination host）</p>
</li>
<li><p>注：不可知是完全不可以解析，不可达是可以解析但是不可以到达</p>
</li>
</ul>
<h2 id="4-ICMP-差错报告报文的数据字段的内容"><a href="#4-ICMP-差错报告报文的数据字段的内容" class="headerlink" title="4. ICMP 差错报告报文的数据字段的内容"></a>4. ICMP 差错报告报文的数据字段的内容</h2><p><img src="/2025/02/24/%E5%9B%9B%E3%80%81NetworkLayer/image-59.png" alt="alt text"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' loading="lazy" onerror='this.onerror=null;this.src="/img/404.jpg"'></p>
<ol>
<li>一般会把原始的 IP 数据报文的数据报首部 + 8 字节（数据的，可能会包含端口信息）作为 ICMP 的数据部分</li>
<li>ICMP 的前 8 个字节的是确定的（前 4 个字节是类型，校验位，后面四个字节是确定的）</li>
<li>然后添加一个首部作为 IP 数据报进行发送。</li>
</ol>
<h2 id="5-不应发生ICMP差错报告报文的几种情况"><a href="#5-不应发生ICMP差错报告报文的几种情况" class="headerlink" title="5. 不应发生ICMP差错报告报文的几种情况"></a>5. 不应发生ICMP差错报告报文的几种情况</h2><ol>
<li>对 ICMP 差错报告报文不再发送 ICMP 差错报告报文</li>
<li>对第一个分片的数据报片的所有后续数据报片都不发送 ICMP 差错报告报文</li>
<li>对具有多播地址的数据报都不发送 ICMP 差错报告报文</li>
<li>对具有特殊地址（如127.0.0.0或0.0.0.0）的数据报不发送 ICMP 差错报告报文</li>
</ol>
<h2 id="6-PING（Packet-InterNet-Groper）"><a href="#6-PING（Packet-InterNet-Groper）" class="headerlink" title="6. PING（Packet InterNet Groper）"></a>6. PING（Packet InterNet Groper）</h2><ul>
<li>PING 是用**ICMP的”Echo request”和”Echo reply”**消息来实现的</li>
<li>PING 用来<strong>测试两个主机之间的连通性</strong></li>
<li>PING 使用了ICMP 回送请求与回送回答报文</li>
<li>PING 是<strong>应用层直接使用网络层 ICMP 的例子</strong>，它没有通过运输层的TCP或UDP</li>
</ul>

</article>
    
    <div class="trm-reward">
        
            <span class="trm-reward-btn trm-glow" onclick='var qr = document.getElementById("qr"); qr.style.display = (qr.style.display === "none") ? "block" : "none";'>
                <i class="iconfont fas fa-hand-holding-usd"></i>
            </span>
        
        <p class="trm-reward-comment">If you like my blog, you can approve me by scanning the QR code below.</p>
        <div id="qr" style="display:none;">
            
                <div style="display:inline-block">
                    <a rel="noopener noreferrer" href='/assets/reward.jpg' target='_blank' >
                       <img src="/assets/reward.jpg" alt="微信" loading="lazy">
                    </a>
                    <p>微信</p>
                </div>
            
        </div>
    </div>

    

</div>
<div class="trm-post-next-prev row">
    <div class="col-lg-12">
        <!-- title -->
        <h5 class="trm-title-with-divider">
            Other Articles
            <span data-number="02"></span>
        </h5>
    </div>
    
        <div class="col-lg-6">
    <div class="trm-blog-card trm-scroll-animation">
        <a href="/2025/02/24/%E4%BA%94%E3%80%81%E8%BF%90%E8%BE%93%E5%B1%82/" class="trm-cover-frame trm-anima-link">
            
            
                <img alt="cover" class="no-fancybox" src="/img/block.jpg">
            
        </a>
        
        <div class="trm-card-descr">
            <div class="trm-label trm-category trm-mb-20">
                <a href=" /categories/%E4%BA%92%E8%81%94%E7%BD%91%E8%AE%A1%E7%AE%97/">
                    互联网计算
                </a>
            </div>
            <h5>
                <a href="/2025/02/24/%E4%BA%94%E3%80%81%E8%BF%90%E8%BE%93%E5%B1%82/" class="trm-anima-link">
                    五、OSI第四层:运输层
                </a>
            </h5>
            <div class="trm-divider trm-mb-20 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>25/02/24</li>
                <li>17:33</li>
                
                    <li>5.3k</li>
                
                
                    <li>19</li>
                
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="col-lg-6">
    <div class="trm-blog-card trm-scroll-animation">
        <a href="/2025/02/24/3.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/" class="trm-cover-frame trm-anima-link">
            
            
                <img alt="cover" class="no-fancybox" src="/img/block.jpg">
            
        </a>
        
        <div class="trm-card-descr">
            <div class="trm-label trm-category trm-mb-20">
                <a href=" /categories/%E4%BA%92%E8%81%94%E7%BD%91%E8%AE%A1%E7%AE%97/">
                    互联网计算
                </a>
            </div>
            <h5>
                <a href="/2025/02/24/3.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/" class="trm-anima-link">
                    三、OSI第二层：数据链路层
                </a>
            </h5>
            <div class="trm-divider trm-mb-20 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>25/02/24</li>
                <li>17:28</li>
                
                    <li>8.3k</li>
                
                
                    <li>30</li>
                
            </ul>
        </div>
    </div>
</div>
    
</div>

    



                    <div class="trm-divider footer-divider"></div>

                    <!-- footer -->
                    <footer class="trm-footer-card trm-scroll-animation">

    

    

      

    
        <div class="trm-footer-item blog-run-long"></div>
     

    
        <div class="trm-footer-item">
            你走过的弯路，都是通向正轨的必经之路。
        </div>
     
</footer>
                    <!-- footer end -->

                </div>
            </div>
        </div>
    </div>
</div>
            <!-- body end -->

            

    <div id="post-toc" class="trm-post-toc">
      <div class="trm-post-toc-header">
        Article table of contents
				<span id="post-toc-top">
					TOP
				</span>
      </div>
      <div class="trm-post-toc-content">
        <ol class="trm-toc"><li class="trm-toc-item trm-toc-level-1" title="第三层：网络层"><a rel="nofollow" class="trm-toc-link" href="#第三层：网络层"><span class="trm-toc-number">1.</span> <span class="trm-toc-text">第三层：网络层</span></a></li><li class="trm-toc-item trm-toc-level-1" title="一、网络层概述"><a rel="nofollow" class="trm-toc-link" href="#一、网络层概述"><span class="trm-toc-number">2.</span> <span class="trm-toc-text">一、网络层概述</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="1. 第三层职责"><a rel="nofollow" class="trm-toc-link" href="#1-第三层职责"><span class="trm-toc-number">2.1.</span> <span class="trm-toc-text">1. 第三层职责</span></a></li><li class="trm-toc-item trm-toc-level-2" title="2. Devices"><a rel="nofollow" class="trm-toc-link" href="#2-Devices"><span class="trm-toc-number">2.2.</span> <span class="trm-toc-text">2. Devices</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="二、IP地址和子网划分(IP Addresses and Subnets)"><a rel="nofollow" class="trm-toc-link" href="#二、IP地址和子网划分-IP-Addresses-and-Subnets"><span class="trm-toc-number">3.</span> <span class="trm-toc-text">二、IP地址和子网划分(IP Addresses and Subnets)</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="1. Layer 3 Packet&#x2F;Datagram 第三层数据报格式"><a rel="nofollow" class="trm-toc-link" href="#1-Layer-3-Packet-Datagram-第三层数据报格式"><span class="trm-toc-number">3.1.</span> <span class="trm-toc-text">1. Layer 3 Packet&#x2F;Datagram 第三层数据报格式</span></a></li><li class="trm-toc-item trm-toc-level-2" title="2. IPv4报文主要结构"><a rel="nofollow" class="trm-toc-link" href="#2-IPv4报文主要结构"><span class="trm-toc-number">3.2.</span> <span class="trm-toc-text">2. IPv4报文主要结构</span></a></li><li class="trm-toc-item trm-toc-level-2" title="3. 网络层地址 Network Layer Addresses"><a rel="nofollow" class="trm-toc-link" href="#3-网络层地址-Network-Layer-Addresses"><span class="trm-toc-number">3.3.</span> <span class="trm-toc-text">3. 网络层地址 Network Layer Addresses</span></a></li><li class="trm-toc-item trm-toc-level-2" title="4. IP地址"><a rel="nofollow" class="trm-toc-link" href="#4-IP地址"><span class="trm-toc-number">3.4.</span> <span class="trm-toc-text">4. IP地址</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="4.1 分类"><a rel="nofollow" class="trm-toc-link" href="#4-1-分类"><span class="trm-toc-number">3.4.1.</span> <span class="trm-toc-text">4.1 分类</span></a></li><li class="trm-toc-item trm-toc-level-3" title="4.2 主机(Hosts)的数量"><a rel="nofollow" class="trm-toc-link" href="#4-2-主机-Hosts-的数量"><span class="trm-toc-number">3.4.2.</span> <span class="trm-toc-text">4.2 主机(Hosts)的数量</span></a></li><li class="trm-toc-item trm-toc-level-3" title="4.3 保留(Reserved)地址"><a rel="nofollow" class="trm-toc-link" href="#4-3-保留-Reserved-地址"><span class="trm-toc-number">3.4.3.</span> <span class="trm-toc-text">4.3 保留(Reserved)地址</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="5. Subnet(子网)"><a rel="nofollow" class="trm-toc-link" href="#5-Subnet-子网"><span class="trm-toc-number">3.5.</span> <span class="trm-toc-text">5. Subnet(子网)</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="5.1.Basics of Subnetting"><a rel="nofollow" class="trm-toc-link" href="#5-1-Basics-of-Subnetting"><span class="trm-toc-number">3.5.1.</span> <span class="trm-toc-text">5.1.Basics of Subnetting</span></a></li><li class="trm-toc-item trm-toc-level-3" title="5.2.How many bits can I borrow(可以借多少位给子网)"><a rel="nofollow" class="trm-toc-link" href="#5-2-How-many-bits-can-I-borrow-可以借多少位给子网"><span class="trm-toc-number">3.5.2.</span> <span class="trm-toc-text">5.2.How many bits can I borrow(可以借多少位给子网)</span></a></li><li class="trm-toc-item trm-toc-level-3" title="5.3.子网划分的副产品：地址浪费Waste Addresses"><a rel="nofollow" class="trm-toc-link" href="#5-3-子网划分的副产品：地址浪费Waste-Addresses"><span class="trm-toc-number">3.5.3.</span> <span class="trm-toc-text">5.3.子网划分的副产品：地址浪费Waste Addresses</span></a></li><li class="trm-toc-item trm-toc-level-3" title="5.4 Subnet Mask子网掩码"><a rel="nofollow" class="trm-toc-link" href="#5-4-Subnet-Mask子网掩码"><span class="trm-toc-number">3.5.4.</span> <span class="trm-toc-text">5.4 Subnet Mask子网掩码</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="6. 计算子网"><a rel="nofollow" class="trm-toc-link" href="#6-计算子网"><span class="trm-toc-number">3.6.</span> <span class="trm-toc-text">6. 计算子网</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="Step 1"><a rel="nofollow" class="trm-toc-link" href="#Step-1"><span class="trm-toc-number">3.6.1.</span> <span class="trm-toc-text">Step 1</span></a></li><li class="trm-toc-item trm-toc-level-3" title="Step 2"><a rel="nofollow" class="trm-toc-link" href="#Step-2"><span class="trm-toc-number">3.6.2.</span> <span class="trm-toc-text">Step 2</span></a></li><li class="trm-toc-item trm-toc-level-3" title="Step 3"><a rel="nofollow" class="trm-toc-link" href="#Step-3"><span class="trm-toc-number">3.6.3.</span> <span class="trm-toc-text">Step 3</span></a></li><li class="trm-toc-item trm-toc-level-3" title="Step 4"><a rel="nofollow" class="trm-toc-link" href="#Step-4"><span class="trm-toc-number">3.6.4.</span> <span class="trm-toc-text">Step 4</span></a></li><li class="trm-toc-item trm-toc-level-3" title="Step 5"><a rel="nofollow" class="trm-toc-link" href="#Step-5"><span class="trm-toc-number">3.6.5.</span> <span class="trm-toc-text">Step 5</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="7. 计算子网网络地址"><a rel="nofollow" class="trm-toc-link" href="#7-计算子网网络地址"><span class="trm-toc-number">3.7.</span> <span class="trm-toc-text">7. 计算子网网络地址</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="7.1 路由器与IP地址"><a rel="nofollow" class="trm-toc-link" href="#7-1-路由器与IP地址"><span class="trm-toc-number">3.7.1.</span> <span class="trm-toc-text">7.1 路由器与IP地址</span></a></li><li class="trm-toc-item trm-toc-level-3" title="实践：IP寻址问题"><a rel="nofollow" class="trm-toc-link" href="#实践：IP寻址问题"><span class="trm-toc-number">3.7.2.</span> <span class="trm-toc-text">实践：IP寻址问题</span></a></li></ol></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="三、第三层设备"><a rel="nofollow" class="trm-toc-link" href="#三、第三层设备"><span class="trm-toc-number">4.</span> <span class="trm-toc-text">三、第三层设备</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="1. 路径选择 Path determination"><a rel="nofollow" class="trm-toc-link" href="#1-路径选择-Path-determination"><span class="trm-toc-number">4.1.</span> <span class="trm-toc-text">1. 路径选择 Path determination</span></a></li><li class="trm-toc-item trm-toc-level-2" title="2. IP 地址"><a rel="nofollow" class="trm-toc-link" href="#2-IP-地址"><span class="trm-toc-number">4.2.</span> <span class="trm-toc-text">2. IP 地址</span></a></li><li class="trm-toc-item trm-toc-level-2" title="3. 路由器端口 Router Interface"><a rel="nofollow" class="trm-toc-link" href="#3-路由器端口-Router-Interface"><span class="trm-toc-number">4.3.</span> <span class="trm-toc-text">3. 路由器端口 Router Interface</span></a></li><li class="trm-toc-item trm-toc-level-2" title="4. 路由器发送的过程 Router function"><a rel="nofollow" class="trm-toc-link" href="#4-路由器发送的过程-Router-function"><span class="trm-toc-number">4.4.</span> <span class="trm-toc-text">4. 路由器发送的过程 Router function</span></a></li><li class="trm-toc-item trm-toc-level-2" title="5. 路由器端口示例"><a rel="nofollow" class="trm-toc-link" href="#5-路由器端口示例"><span class="trm-toc-number">4.5.</span> <span class="trm-toc-text">5. 路由器端口示例</span></a></li><li class="trm-toc-item trm-toc-level-2" title="6. IP地址分配 IP address assignment"><a rel="nofollow" class="trm-toc-link" href="#6-IP地址分配-IP-address-assignment"><span class="trm-toc-number">4.6.</span> <span class="trm-toc-text">6. IP地址分配 IP address assignment</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="四、ARP Protocol"><a rel="nofollow" class="trm-toc-link" href="#四、ARP-Protocol"><span class="trm-toc-number">5.</span> <span class="trm-toc-text">四、ARP Protocol</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="1. Address Resolution Protocol（ARP）地址解析协议"><a rel="nofollow" class="trm-toc-link" href="#1-Address-Resolution-Protocol（ARP）地址解析协议"><span class="trm-toc-number">5.1.</span> <span class="trm-toc-text">1. Address Resolution Protocol（ARP）地址解析协议</span></a></li><li class="trm-toc-item trm-toc-level-2" title="2. ARP示例"><a rel="nofollow" class="trm-toc-link" href="#2-ARP示例"><span class="trm-toc-number">5.2.</span> <span class="trm-toc-text">2. ARP示例</span></a></li><li class="trm-toc-item trm-toc-level-2" title="3. ARP表的缓存"><a rel="nofollow" class="trm-toc-link" href="#3-ARP表的缓存"><span class="trm-toc-number">5.3.</span> <span class="trm-toc-text">3. ARP表的缓存</span></a></li><li class="trm-toc-item trm-toc-level-2" title="4. ARP 操作"><a rel="nofollow" class="trm-toc-link" href="#4-ARP-操作"><span class="trm-toc-number">5.4.</span> <span class="trm-toc-text">4. ARP 操作</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="4.1 ARP request"><a rel="nofollow" class="trm-toc-link" href="#4-1-ARP-request"><span class="trm-toc-number">5.4.1.</span> <span class="trm-toc-text">4.1 ARP request</span></a></li><li class="trm-toc-item trm-toc-level-3" title="4.2 Checking"><a rel="nofollow" class="trm-toc-link" href="#4-2-Checking"><span class="trm-toc-number">5.4.2.</span> <span class="trm-toc-text">4.2 Checking</span></a></li><li class="trm-toc-item trm-toc-level-3" title="4.3 ARP reply"><a rel="nofollow" class="trm-toc-link" href="#4-3-ARP-reply"><span class="trm-toc-number">5.4.3.</span> <span class="trm-toc-text">4.3 ARP reply</span></a></li><li class="trm-toc-item trm-toc-level-3" title="4.4 Caching"><a rel="nofollow" class="trm-toc-link" href="#4-4-Caching"><span class="trm-toc-number">5.4.4.</span> <span class="trm-toc-text">4.4 Caching</span></a></li><li class="trm-toc-item trm-toc-level-3" title="总结 ARP协议工作原理:"><a rel="nofollow" class="trm-toc-link" href="#总结-ARP协议工作原理"><span class="trm-toc-number">5.4.5.</span> <span class="trm-toc-text">总结 ARP协议工作原理:</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="5. ARP: Destination local 目的地址为本地"><a rel="nofollow" class="trm-toc-link" href="#5-ARP-Destination-local-目的地址为本地"><span class="trm-toc-number">5.5.</span> <span class="trm-toc-text">5. ARP: Destination local 目的地址为本地</span></a></li><li class="trm-toc-item trm-toc-level-2" title="6. ARP: Internetwork Communication 网络交流"><a rel="nofollow" class="trm-toc-link" href="#6-ARP-Internetwork-Communication-网络交流"><span class="trm-toc-number">5.6.</span> <span class="trm-toc-text">6. ARP: Internetwork Communication 网络交流</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="6.1 默认网关 Default gateway:"><a rel="nofollow" class="trm-toc-link" href="#6-1-默认网关-Default-gateway"><span class="trm-toc-number">5.6.1.</span> <span class="trm-toc-text">6.1 默认网关 Default gateway:</span></a></li><li class="trm-toc-item trm-toc-level-3" title="6.2 Proxy ARP 代理ARP："><a rel="nofollow" class="trm-toc-link" href="#6-2-Proxy-ARP-代理ARP："><span class="trm-toc-number">5.6.2.</span> <span class="trm-toc-text">6.2 Proxy ARP 代理ARP：</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="7. ARP: Destination not local"><a rel="nofollow" class="trm-toc-link" href="#7-ARP-Destination-not-local"><span class="trm-toc-number">5.7.</span> <span class="trm-toc-text">7. ARP: Destination not local</span></a></li><li class="trm-toc-item trm-toc-level-2" title="8. ARP Flowchart ARP流程图"><a rel="nofollow" class="trm-toc-link" href="#8-ARP-Flowchart-ARP流程图"><span class="trm-toc-number">5.8.</span> <span class="trm-toc-text">8. ARP Flowchart ARP流程图</span></a></li><li class="trm-toc-item trm-toc-level-2" title=""><a class="trm-toc-link"><span class="trm-toc-number">5.9.</span> <span class="trm-toc-text"></span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="五、网络层服务"><a rel="nofollow" class="trm-toc-link" href="#五、网络层服务"><span class="trm-toc-number">6.</span> <span class="trm-toc-text">五、网络层服务</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="1. 面向连接的网络服务 Connection-oriented"><a rel="nofollow" class="trm-toc-link" href="#1-面向连接的网络服务-Connection-oriented"><span class="trm-toc-number">6.1.</span> <span class="trm-toc-text">1. 面向连接的网络服务 Connection-oriented</span></a></li><li class="trm-toc-item trm-toc-level-2" title="1.1 电路交换 Circuit-switched"><a rel="nofollow" class="trm-toc-link" href="#1-1-电路交换-Circuit-switched"><span class="trm-toc-number">6.2.</span> <span class="trm-toc-text">1.1 电路交换 Circuit-switched</span></a></li><li class="trm-toc-item trm-toc-level-2" title="2. 无连接的网络服务 Connectionless"><a rel="nofollow" class="trm-toc-link" href="#2-无连接的网络服务-Connectionless"><span class="trm-toc-number">6.3.</span> <span class="trm-toc-text">2. 无连接的网络服务 Connectionless</span></a></li><li class="trm-toc-item trm-toc-level-2" title="2.1 数据包交换 Packet switched"><a rel="nofollow" class="trm-toc-link" href="#2-1-数据包交换-Packet-switched"><span class="trm-toc-number">6.4.</span> <span class="trm-toc-text">2.1 数据包交换 Packet switched</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="六、Routed and Routing protocol 路由和路由协议"><a rel="nofollow" class="trm-toc-link" href="#六、Routed-and-Routing-protocol-路由和路由协议"><span class="trm-toc-number">7.</span> <span class="trm-toc-text">六、Routed and Routing protocol 路由和路由协议</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="1. Routed protocol 被动可路由协议"><a rel="nofollow" class="trm-toc-link" href="#1-Routed-protocol-被动可路由协议"><span class="trm-toc-number">7.1.</span> <span class="trm-toc-text">1. Routed protocol 被动可路由协议</span></a></li><li class="trm-toc-item trm-toc-level-2" title="2. Non-routable protocol 不可路由协议"><a rel="nofollow" class="trm-toc-link" href="#2-Non-routable-protocol-不可路由协议"><span class="trm-toc-number">7.2.</span> <span class="trm-toc-text">2. Non-routable protocol 不可路由协议</span></a></li><li class="trm-toc-item trm-toc-level-2" title="3. 被动可路由协议的寻址 Addressing of a routable protocol"><a rel="nofollow" class="trm-toc-link" href="#3-被动可路由协议的寻址-Addressing-of-a-routable-protocol"><span class="trm-toc-number">7.3.</span> <span class="trm-toc-text">3. 被动可路由协议的寻址 Addressing of a routable protocol</span></a></li><li class="trm-toc-item trm-toc-level-2" title="4. 路由协议分类1：Static and Dynamic 静态和动态"><a rel="nofollow" class="trm-toc-link" href="#4-路由协议分类1：Static-and-Dynamic-静态和动态"><span class="trm-toc-number">7.4.</span> <span class="trm-toc-text">4. 路由协议分类1：Static and Dynamic 静态和动态</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="4.1 Routing protocol 主动路由协议(Routing)"><a rel="nofollow" class="trm-toc-link" href="#4-1-Routing-protocol-主动路由协议-Routing"><span class="trm-toc-number">7.4.1.</span> <span class="trm-toc-text">4.1 Routing protocol 主动路由协议(Routing)</span></a></li><li class="trm-toc-item trm-toc-level-3" title="4.2 Routed vs. Routing protocol"><a rel="nofollow" class="trm-toc-link" href="#4-2-Routed-vs-Routing-protocol"><span class="trm-toc-number">7.4.2.</span> <span class="trm-toc-text">4.2 Routed vs. Routing protocol</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="5. 路由协议分类2（动态路由协议）：IGP and EGP"><a rel="nofollow" class="trm-toc-link" href="#5-路由协议分类2（动态路由协议）：IGP-and-EGP"><span class="trm-toc-number">7.5.</span> <span class="trm-toc-text">5. 路由协议分类2（动态路由协议）：IGP and EGP</span></a></li><li class="trm-toc-item trm-toc-level-2" title="6. 路由协议分类3（内部网关协议）：DVP and LSP"><a rel="nofollow" class="trm-toc-link" href="#6-路由协议分类3（内部网关协议）：DVP-and-LSP"><span class="trm-toc-number">7.6.</span> <span class="trm-toc-text">6. 路由协议分类3（内部网关协议）：DVP and LSP</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="6.1 距离矢量协议DVP的示例"><a rel="nofollow" class="trm-toc-link" href="#6-1-距离矢量协议DVP的示例"><span class="trm-toc-number">7.6.1.</span> <span class="trm-toc-text">6.1 距离矢量协议DVP的示例</span></a></li><li class="trm-toc-item trm-toc-level-3" title="6.2 链路状态协议LSP的示例"><a rel="nofollow" class="trm-toc-link" href="#6-2-链路状态协议LSP的示例"><span class="trm-toc-number">7.6.2.</span> <span class="trm-toc-text">6.2 链路状态协议LSP的示例</span></a></li></ol></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="七、VLSM 可变长度子网掩码"><a rel="nofollow" class="trm-toc-link" href="#七、VLSM-可变长度子网掩码"><span class="trm-toc-number">8.</span> <span class="trm-toc-text">七、VLSM 可变长度子网掩码</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="1. Classful Routing（类路由）"><a rel="nofollow" class="trm-toc-link" href="#1-Classful-Routing（类路由）"><span class="trm-toc-number">8.1.</span> <span class="trm-toc-text">1. Classful Routing（类路由）</span></a></li><li class="trm-toc-item trm-toc-level-2" title="2. VLSM — Variable Length Subnet Mask"><a rel="nofollow" class="trm-toc-link" href="#2-VLSM-—-Variable-Length-Subnet-Mask"><span class="trm-toc-number">8.2.</span> <span class="trm-toc-text">2. VLSM — Variable Length Subnet Mask</span></a></li><li class="trm-toc-item trm-toc-level-2" title="3. 如何使用VLSM"><a rel="nofollow" class="trm-toc-link" href="#3-如何使用VLSM"><span class="trm-toc-number">8.3.</span> <span class="trm-toc-text">3. 如何使用VLSM</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="3.0 划分背景"><a rel="nofollow" class="trm-toc-link" href="#3-0-划分背景"><span class="trm-toc-number">8.3.1.</span> <span class="trm-toc-text">3.0 划分背景</span></a></li><li class="trm-toc-item trm-toc-level-3" title="3.1 第一步：满足珀斯的主机需求（需求最大）"><a rel="nofollow" class="trm-toc-link" href="#3-1-第一步：满足珀斯的主机需求（需求最大）"><span class="trm-toc-number">8.3.2.</span> <span class="trm-toc-text">3.1 第一步：满足珀斯的主机需求（需求最大）</span></a></li><li class="trm-toc-item trm-toc-level-3" title="3.2 第二步：为吉隆坡划分子网（需求第二）"><a rel="nofollow" class="trm-toc-link" href="#3-2-第二步：为吉隆坡划分子网（需求第二）"><span class="trm-toc-number">8.3.3.</span> <span class="trm-toc-text">3.2 第二步：为吉隆坡划分子网（需求第二）</span></a></li><li class="trm-toc-item trm-toc-level-3" title="3.3 第三步：为悉尼和新加坡进行分配地址（需求第三）"><a rel="nofollow" class="trm-toc-link" href="#3-3-第三步：为悉尼和新加坡进行分配地址（需求第三）"><span class="trm-toc-number">8.3.4.</span> <span class="trm-toc-text">3.3 第三步：为悉尼和新加坡进行分配地址（需求第三）</span></a></li><li class="trm-toc-item trm-toc-level-3" title="3.4 第四步：为之间的路由地址进行划分"><a rel="nofollow" class="trm-toc-link" href="#3-4-第四步：为之间的路由地址进行划分"><span class="trm-toc-number">8.3.5.</span> <span class="trm-toc-text">3.4 第四步：为之间的路由地址进行划分</span></a></li><li class="trm-toc-item trm-toc-level-3" title="总结："><a rel="nofollow" class="trm-toc-link" href="#总结："><span class="trm-toc-number">8.3.6.</span> <span class="trm-toc-text">总结：</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="4. Route Aggregation 路由聚合"><a rel="nofollow" class="trm-toc-link" href="#4-Route-Aggregation-路由聚合"><span class="trm-toc-number">8.4.</span> <span class="trm-toc-text">4. Route Aggregation 路由聚合</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="4.0 例子"><a rel="nofollow" class="trm-toc-link" href="#4-0-例子"><span class="trm-toc-number">8.4.1.</span> <span class="trm-toc-text">4.0 例子</span></a></li><li class="trm-toc-item trm-toc-level-3" title="4.1 如何进行路由聚合"><a rel="nofollow" class="trm-toc-link" href="#4-1-如何进行路由聚合"><span class="trm-toc-number">8.4.2.</span> <span class="trm-toc-text">4.1 如何进行路由聚合</span></a></li></ol></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="八、ICMP 因特网控制报文协议"><a rel="nofollow" class="trm-toc-link" href="#八、ICMP-因特网控制报文协议"><span class="trm-toc-number">9.</span> <span class="trm-toc-text">八、ICMP 因特网控制报文协议</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="1. ICMP 报文的格式"><a rel="nofollow" class="trm-toc-link" href="#1-ICMP-报文的格式"><span class="trm-toc-number">9.1.</span> <span class="trm-toc-text">1. ICMP 报文的格式</span></a></li><li class="trm-toc-item trm-toc-level-2" title="2. 两种ICMP报文"><a rel="nofollow" class="trm-toc-link" href="#2-两种ICMP报文"><span class="trm-toc-number">9.2.</span> <span class="trm-toc-text">2. 两种ICMP报文</span></a></li><li class="trm-toc-item trm-toc-level-2" title="3. 目的站不可到达"><a rel="nofollow" class="trm-toc-link" href="#3-目的站不可到达"><span class="trm-toc-number">9.3.</span> <span class="trm-toc-text">3. 目的站不可到达</span></a></li><li class="trm-toc-item trm-toc-level-2" title="4. ICMP 差错报告报文的数据字段的内容"><a rel="nofollow" class="trm-toc-link" href="#4-ICMP-差错报告报文的数据字段的内容"><span class="trm-toc-number">9.4.</span> <span class="trm-toc-text">4. ICMP 差错报告报文的数据字段的内容</span></a></li><li class="trm-toc-item trm-toc-level-2" title="5. 不应发生ICMP差错报告报文的几种情况"><a rel="nofollow" class="trm-toc-link" href="#5-不应发生ICMP差错报告报文的几种情况"><span class="trm-toc-number">9.5.</span> <span class="trm-toc-text">5. 不应发生ICMP差错报告报文的几种情况</span></a></li><li class="trm-toc-item trm-toc-level-2" title="6. PING（Packet InterNet Groper）"><a rel="nofollow" class="trm-toc-link" href="#6-PING（Packet-InterNet-Groper）"><span class="trm-toc-number">9.6.</span> <span class="trm-toc-text">6. PING（Packet InterNet Groper）</span></a></li></ol></li></ol>
      </div>
    </div>

            
<div class="trm-fixed-container">
    
        <div class="trm-fixed-btn post-toc-btn" data-title="Open toc">
            <i class="iconfont fas fa-th-list"></i>
        </div>
    
    
        <div class="trm-fixed-btn" data-title="Read Mode" onclick="asyncFun.switchReadMode()">
            <i class="iconfont fas fa-book-reader"></i>
        </div>
    
    
    <div id="trm-back-top" class="trm-fixed-btn" data-title="Back To Top">
        <i class="iconfont fas fa-arrow-up"></i>
    </div>
</div>
        </div>
      </div>
      <!-- scroll container end -->
  </div>
  <!-- app wrapper end -->

  
    <div class="trm-search-popup">
        <div class="trm-search-wrapper">
            <div class="form trm-search-form">
                <div class="trm-search-input-icon">
                    <i class="iconfont fas fa-search"></i>
                </div>
                <input class="trm-search-input" type="text" placeholder="Searching...">
                <div class="trm-search-btn-close">
                    <i class="iconfont fas fa-times"></i>
                </div>
            </div>
            <div class="trm-search-result-container">
                <div class="trm-search-empty">
                    Please enter keywords to search
                </div>
            </div>
            <div class="trm-search-footer">
                <div class="trm-search-stats"></div>
                <ul class="trm-search-commands">
                    <li>
                        <kbd class="command-palette-commands-key">
                            <svg width="15" height="15" aria-label="Escape key" role="img">
                                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="1.2">
                                    <path
                                        d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993 0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016.8634 0 1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5c.032.5663-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864 0 1.6425 1.031 1.5443 2.2492h-2.956">
                                    </path>
                                </g>
                            </svg>
                        </kbd>
                        <span class="command-palette-Label">to close</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

  <!-- Plugin -->




    
    
<script src="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>

    

    

    
        
<script src="https://unpkg.com/hexo-generator-searchdb@1.4.0/dist/search.js"></script>

        <script src="/js/plugins/local_search.js?v=2.2.4"></script>
    

    <!-- 数学公式 -->
    

    <!-- 评论插件 -->
    
        

        
    

		




    <!-- Service Worker -->
    
    <!-- baidu push -->
    


<script id="async-script" src="/js/main.js?v=2.2.4"></script>

<!-- CDN -->


    

    

    



</body>

</html>